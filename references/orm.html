<!DOCTYPE html>
<html lang="en" data-accent-color="cyan" data-content_root="../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>ORM - cartography documentation</title><link rel="shortcut icon" href="../_static/logo-vertical.svg"/><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Sync" href="sync.html" /><link rel="prev" title="Model" href="model.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=e1a1ceaf" />
    <link rel="stylesheet" type="text/css" href="../_static/shibuya.css?v=a318c5d4" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link media="print" rel="stylesheet" type="text/css" href="../_static/print.css?v=20ff2c19" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=1da16d3f" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-heading: 'Inter', var(--sy-f-sys), sans-serif;
}
</style>
    <meta property="og:type" content="website"/><meta property="og:title" content="ORM"/>
    <meta name="twitter:card" content="summary"/>
  </head>
<body><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="../index.html">
      <img class="light-logo" src="../_static/logo-vertical.svg" alt="cartography" height="28" loading="lazy" />
      <img class="dark-logo" src="../_static/logo-vertical.svg" alt="cartography" height="28" loading="lazy" />
      <strong>cartography</strong>
    </a>
    <div class="sy-head-nav" id="head-nav">
      <nav class="sy-head-links"></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><div class="sy-head-socials">
  <a href="https://github.com/cartography-cncf/cartography" aria-label="GitHub">
    <iconify-icon icon="simple-icons:github"></iconify-icon>
  </a>
  <a href="https://communityinviter.com/apps/cloud-native/cncf" aria-label="Slack">
    <iconify-icon icon="simple-icons:slack"></iconify-icon>
  </a></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="head-nav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2"></span>
          <span class="hamburger_3"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><p class="caption" role="heading" aria-level="3"><span class="caption-text">Basic Use</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Quick start: Install and Run Cartography On Test Machine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/index.html">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../usage/rules.html">Cartography Rules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/tutorial.html">Usage Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/drift-detect.html">How to use Drift-Detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/applications.html">Building around Cartography</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/samplequeries.html">Sample queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/schema.html">Cartography Schema</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/aws-privilege-escalation-queries.html">AWS IAM Privilege Escalation Methods and Mitigation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ops.html">Cartography Production Operations</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">Intel Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules/airbyte/index.html">Airbyte</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/airbyte/config.html">Airbyte Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/airbyte/schema.html">Airbyte Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/anthropic/index.html">Anthropic</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/anthropic/config.html">Anthropic Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/anthropic/schema.html">Anthropic Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/aws/index.html">Amazon Web Services (AWS)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/aws/config.html">AWS Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/aws/permissions-mapping.html">Permissions Mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/aws/schema.html">AWS Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/azure/index.html">Microsoft Azure</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/azure/config.html">Azure Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/azure/schema.html">Azure Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/bigfix/index.html">BigFix</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/bigfix/config.html">BigFix Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/bigfix/schema.html">BigFix Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/cloudflare/index.html">Cloudflare</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/cloudflare/config.html">Cloudflare Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/cloudflare/schema.html">Cloudflare Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/crowdstrike/index.html">Crowdstrike</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/crowdstrike/config.html">Crowdstrike Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/crowdstrike/schema.html">Crowdstrike Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/cve/index.html">CVE</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/cve/config.html">CVE Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/cve/schema.html">CVE Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/digitalocean/index.html">DigitalOcean</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/digitalocean/config.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/digitalocean/schema.html">DigitalOcean Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/duo/index.html">Duo</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/duo/config.html">Duo Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/duo/schema.html">Duo Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/entra/index.html">Microsoft Entra (formerly Azure AD)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/entra/config.html">Entra Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/entra/schema.html">Entra Schema</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/entra/examples.html">Example Queries</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/gcp/index.html">Google Cloud Platform (GCP)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/gcp/config.html">GCP Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/gcp/schema.html">GCP Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/github/index.html">Github</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/github/config.html">GitHub Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/github/schema.html">Github Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/gitlab/index.html">GitLab</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/gitlab/config.html">GitLab Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/gitlab/schema.html">GitLab Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/googleworkspace/index.html">Google Workspace</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/googleworkspace/config.html">Google Workspace Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/googleworkspace/schema.html">Google Workspace Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/gsuite/index.html">Google GSuite</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/gsuite/config.html">GSuite Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/gsuite/config.html#method-2-using-oauth">Method 2: Using OAuth</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/gsuite/schema.html">GSuite Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/jamf/index.html">Jamf</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/jamf/schema.html">Jamf Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/kandji/index.html">Kandji</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/kandji/config.html">Kandji Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/kandji/schema.html">Kandji Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/keycloak/index.html">Keycloak</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/keycloak/config.html">Keycloak Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/keycloak/schema.html">Keycloak Schema</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/keycloak/analysis.html">Keycloak Built-In Analysis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/kubernetes/index.html">Kubernetes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/kubernetes/config.html">Kubernetes Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/kubernetes/schema.html">Kubernetes Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/lastpass/index.html">Lastpass</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/lastpass/config.html">Lastpass Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/lastpass/schema.html">Lastpass Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/oci/index.html">Oracle Cloud Infrastructure</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/oci/config.html">OCI Config</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/oci/schema.html">OCI Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/okta/index.html">Okta</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/okta/config.html">Okta Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/okta/schema.html">Okta Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/ontology/index.html">Ontology in Cartography</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/ontology/config.html">Ontology Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/ontology/schema.html">Ontology Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/openai/index.html">OpenAI</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/openai/config.html">OpenAI Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/openai/schema.html">OpenAI Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/pagerduty/index.html">PagerDuty</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/pagerduty/config.html">Pagerduty Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/pagerduty/schema.html">Pagerduty Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/scaleway/index.html">Scaleway</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/scaleway/config.html">Scaleway Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/scaleway/schema.html">Scaleway Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/semgrep/index.html">Semgrep</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/semgrep/config.html">Semgrep Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/semgrep/schema.html">Semgrep Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/sentinelone/index.html">SentinelOne</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/sentinelone/config.html">SentinelOne Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/sentinelone/config.html#required-permissions">Required Permissions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/sentinelone/schema.html">SentinelOne Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/slack/index.html">Slack</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/slack/config.html">Slack Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/slack/schema.html">Slack Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/snipeit/index.html">SnipeIT</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/snipeit/config.html">SnipeIT Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/snipeit/schema.html">SnipeIT Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/spacelift/index.html">Spacelift</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/spacelift/config.html">Spacelift Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/spacelift/schema.html">Spacelift Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/tailscale/index.html">Tailscale</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/tailscale/config.html">Tailscale Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/tailscale/schema.html">Tailscale Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/trivy/index.html">Trivy</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/trivy/config.html">Trivy Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/trivy/config.html#notes-on-running-trivy">Notes on running Trivy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/trivy/schema.html">Trivy Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/workday/index.html">Workday</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/workday/config.html">Workday Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/workday/schema.html">Workday Schema</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/workday/examples.html">Sample Cypher Queries</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">Development Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev/developer-guide.html">Cartography Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/writing-intel-modules.html">How to write a new intel module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/writing-analysis-jobs.html">How to extend Cartography with Analysis Jobs</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">References</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="model.html">Model</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">ORM</a></li>
<li class="toctree-l1"><a class="reference internal" href="sync.html">Sync</a></li>
<li class="toctree-l1"><a class="reference internal" href="aws_client.html">AWS Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="driftdetect.html">DriftDetect</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">Get In Touch</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contact.html">Contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contact.html#community-meeting">Community Meeting</a></li>
</ul>

        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div class="localtoc"><h3>On this page</h3><ul>
<li><a class="reference internal" href="#module-cartography.client.core.tx">Client TX</a><ul>
<li><a class="reference internal" href="#cartography.client.core.tx.ensure_indexes"><code class="docutils literal notranslate"><span class="pre">ensure_indexes()</span></code></a></li>
<li><a class="reference internal" href="#cartography.client.core.tx.ensure_indexes_for_matchlinks"><code class="docutils literal notranslate"><span class="pre">ensure_indexes_for_matchlinks()</span></code></a></li>
<li><a class="reference internal" href="#cartography.client.core.tx.execute_write_with_retry"><code class="docutils literal notranslate"><span class="pre">execute_write_with_retry()</span></code></a></li>
<li><a class="reference internal" href="#cartography.client.core.tx.load"><code class="docutils literal notranslate"><span class="pre">load()</span></code></a></li>
<li><a class="reference internal" href="#cartography.client.core.tx.load_graph_data"><code class="docutils literal notranslate"><span class="pre">load_graph_data()</span></code></a></li>
<li><a class="reference internal" href="#cartography.client.core.tx.load_matchlinks"><code class="docutils literal notranslate"><span class="pre">load_matchlinks()</span></code></a></li>
<li><a class="reference internal" href="#cartography.client.core.tx.read_list_of_dicts_tx"><code class="docutils literal notranslate"><span class="pre">read_list_of_dicts_tx()</span></code></a></li>
<li><a class="reference internal" href="#cartography.client.core.tx.read_list_of_tuples_tx"><code class="docutils literal notranslate"><span class="pre">read_list_of_tuples_tx()</span></code></a></li>
<li><a class="reference internal" href="#cartography.client.core.tx.read_list_of_values_tx"><code class="docutils literal notranslate"><span class="pre">read_list_of_values_tx()</span></code></a></li>
<li><a class="reference internal" href="#cartography.client.core.tx.read_single_dict_tx"><code class="docutils literal notranslate"><span class="pre">read_single_dict_tx()</span></code></a></li>
<li><a class="reference internal" href="#cartography.client.core.tx.read_single_value_tx"><code class="docutils literal notranslate"><span class="pre">read_single_value_tx()</span></code></a></li>
<li><a class="reference internal" href="#cartography.client.core.tx.run_write_query"><code class="docutils literal notranslate"><span class="pre">run_write_query()</span></code></a></li>
<li><a class="reference internal" href="#cartography.client.core.tx.write_list_of_dicts_tx"><code class="docutils literal notranslate"><span class="pre">write_list_of_dicts_tx()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-cartography.graph.querybuilder">QueryBuilder</a><ul>
<li><a class="reference internal" href="#cartography.graph.querybuilder.build_create_index_queries"><code class="docutils literal notranslate"><span class="pre">build_create_index_queries()</span></code></a></li>
<li><a class="reference internal" href="#cartography.graph.querybuilder.build_create_index_queries_for_matchlink"><code class="docutils literal notranslate"><span class="pre">build_create_index_queries_for_matchlink()</span></code></a></li>
<li><a class="reference internal" href="#cartography.graph.querybuilder.build_ingestion_query"><code class="docutils literal notranslate"><span class="pre">build_ingestion_query()</span></code></a></li>
<li><a class="reference internal" href="#cartography.graph.querybuilder.build_matchlink_query"><code class="docutils literal notranslate"><span class="pre">build_matchlink_query()</span></code></a></li>
<li><a class="reference internal" href="#cartography.graph.querybuilder.filter_selected_relationships"><code class="docutils literal notranslate"><span class="pre">filter_selected_relationships()</span></code></a></li>
<li><a class="reference internal" href="#cartography.graph.querybuilder.rel_present_on_node_schema"><code class="docutils literal notranslate"><span class="pre">rel_present_on_node_schema()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-cartography.graph.cleanupbuilder">CleanupBuilder</a><ul>
<li><a class="reference internal" href="#cartography.graph.cleanupbuilder.build_cleanup_queries"><code class="docutils literal notranslate"><span class="pre">build_cleanup_queries()</span></code></a></li>
<li><a class="reference internal" href="#cartography.graph.cleanupbuilder.build_cleanup_query_for_matchlink"><code class="docutils literal notranslate"><span class="pre">build_cleanup_query_for_matchlink()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-cartography.graph.job">GraphJob</a><ul>
<li><a class="reference internal" href="#cartography.graph.job.GraphJob"><code class="docutils literal notranslate"><span class="pre">GraphJob</span></code></a><ul>
<li><a class="reference internal" href="#cartography.graph.job.GraphJob.name"><code class="docutils literal notranslate">name</span></code></a></li>
<li><a class="reference internal" href="#cartography.graph.job.GraphJob.statements"><code class="docutils literal notranslate">statements</span></code></a></li>
<li><a class="reference internal" href="#cartography.graph.job.GraphJob.short_name"><code class="docutils literal notranslate">short_name</span></code></a></li>
<li><a class="reference internal" href="#cartography.graph.job.GraphJob.__init__"><code class="docutils literal notranslate">__init__()</span></code></a></li>
<li><a class="reference internal" href="#cartography.graph.job.GraphJob.as_dict"><code class="docutils literal notranslate">as_dict()</span></code></a></li>
<li><a class="reference internal" href="#cartography.graph.job.GraphJob.from_json"><code class="docutils literal notranslate">from_json()</span></code></a></li>
<li><a class="reference internal" href="#cartography.graph.job.GraphJob.from_json_file"><code class="docutils literal notranslate">from_json_file()</span></code></a></li>
<li><a class="reference internal" href="#cartography.graph.job.GraphJob.from_matchlink"><code class="docutils literal notranslate">from_matchlink()</span></code></a></li>
<li><a class="reference internal" href="#cartography.graph.job.GraphJob.from_node_schema"><code class="docutils literal notranslate">from_node_schema()</span></code></a></li>
<li><a class="reference internal" href="#cartography.graph.job.GraphJob.merge_parameters"><code class="docutils literal notranslate">merge_parameters()</span></code></a></li>
<li><a class="reference internal" href="#cartography.graph.job.GraphJob.run"><code class="docutils literal notranslate">run()</span></code></a></li>
<li><a class="reference internal" href="#cartography.graph.job.GraphJob.run_from_json"><code class="docutils literal notranslate">run_from_json()</span></code></a></li>
<li><a class="reference internal" href="#cartography.graph.job.GraphJob.run_from_json_file"><code class="docutils literal notranslate">run_from_json_file()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#cartography.graph.job.GraphJobJSONEncoder"><code class="docutils literal notranslate"><span class="pre">GraphJobJSONEncoder</span></code></a><ul>
<li><a class="reference internal" href="#cartography.graph.job.GraphJobJSONEncoder.default"><code class="docutils literal notranslate">default()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#cartography.graph.job.get_parameters"><code class="docutils literal notranslate"><span class="pre">get_parameters()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-cartography.graph.statement">GraphStatement</a><ul>
<li><a class="reference internal" href="#cartography.graph.statement.GraphStatement"><code class="docutils literal notranslate"><span class="pre">GraphStatement</span></code></a><ul>
<li><a class="reference internal" href="#cartography.graph.statement.GraphStatement.query"><code class="docutils literal notranslate">query</span></code></a></li>
<li><a class="reference internal" href="#cartography.graph.statement.GraphStatement.parameters"><code class="docutils literal notranslate">parameters</span></code></a></li>
<li><a class="reference internal" href="#cartography.graph.statement.GraphStatement.iterative"><code class="docutils literal notranslate">iterative</span></code></a></li>
<li><a class="reference internal" href="#cartography.graph.statement.GraphStatement.iterationsize"><code class="docutils literal notranslate">iterationsize</span></code></a></li>
<li><a class="reference internal" href="#cartography.graph.statement.GraphStatement.parent_job_name"><code class="docutils literal notranslate">parent_job_name</span></code></a></li>
<li><a class="reference internal" href="#cartography.graph.statement.GraphStatement.parent_job_sequence_num"><code class="docutils literal notranslate">parent_job_sequence_num</span></code></a></li>
<li><a class="reference internal" href="#cartography.graph.statement.GraphStatement.__init__"><code class="docutils literal notranslate">__init__()</span></code></a></li>
<li><a class="reference internal" href="#cartography.graph.statement.GraphStatement.as_dict"><code class="docutils literal notranslate">as_dict()</span></code></a></li>
<li><a class="reference internal" href="#cartography.graph.statement.GraphStatement.create_from_json"><code class="docutils literal notranslate">create_from_json()</span></code></a></li>
<li><a class="reference internal" href="#cartography.graph.statement.GraphStatement.create_from_json_file"><code class="docutils literal notranslate">create_from_json_file()</span></code></a></li>
<li><a class="reference internal" href="#cartography.graph.statement.GraphStatement.merge_parameters"><code class="docutils literal notranslate">merge_parameters()</span></code></a></li>
<li><a class="reference internal" href="#cartography.graph.statement.GraphStatement.run"><code class="docutils literal notranslate">run()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#cartography.graph.statement.GraphStatementJSONEncoder"><code class="docutils literal notranslate"><span class="pre">GraphStatementJSONEncoder</span></code></a><ul>
<li><a class="reference internal" href="#cartography.graph.statement.GraphStatementJSONEncoder.default"><code class="docutils literal notranslate">default()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#cartography.graph.statement.get_job_shortname"><code class="docutils literal notranslate"><span class="pre">get_job_shortname()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-cartography.graph.context">Context</a><ul>
<li><a class="reference internal" href="#cartography.graph.context.Context"><code class="docutils literal notranslate"><span class="pre">Context</span></code></a><ul>
<li><a class="reference internal" href="#cartography.graph.context.Context.update_tag"><code class="docutils literal notranslate">update_tag</span></code></a></li>
<li><a class="reference internal" href="#cartography.graph.context.Context.__init__"><code class="docutils literal notranslate">__init__()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div><a class="js-repo-stats repo-stats flex items-center" href="https://github.com/cartography-cncf/cartography"
  data-type="github" data-user="cartography-cncf" data-repo="cartography">
  <span class="w-8 flex items-center justify-around shrink-0 text-3xl">
    <iconify-icon icon="simple-icons:github"></iconify-icon>
  </span>
  <span class="flex-grow px-2 break-all">
    
    
      <span>cartography</span>
    
    <span class="flex text-sm repo-stats-count">
      <span class="flex items-center pr-3">
        <iconify-icon icon="lucide:star"></iconify-icon>
        <strong class="js-repo-stars ml-1">0</strong>
      </span>
      <span class="flex items-center">
        <iconify-icon icon="lucide:git-fork"></iconify-icon>
        <strong class="js-repo-forks ml-1">0</strong>
      </span>
    </span>
  </span>
</a><div class="edit-this-page">
  <a href="https://github.com/cartography-cncf/cartography/blob/master/docs/root/references/orm.md">Edit this page</a>
</div><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../index.html"><span itemprop="name">cartography</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="index.html"><span itemprop="name">&lt;no title&gt;</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">ORM</strong>
        <meta itemprop="position" content="3" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="relative min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
  <div class="copy-page-wrapper relative pb-4 lg:absolute lg:top-8 lg:right-6 xl:right-12">
  <div id="copy-page-trigger">
    <button
      type="button"
      class="js-copy px-3 py-1 inline-flex items-center gap-1"
      data-url="https://raw.githubusercontent.com/cartography-cncf/cartography/refs/heads/master/docs/root/references/orm.md.txt"
    >
      <i class="i-lucide" data-icon="copy"></i>
      <span>Copy page</span>
    </button>
    <button class="js-menu px-2 py-1" type="button" aria-label="More actions"
      aria-haspopup="menu" aria-expanded="false" aria-controls="copy-page-content">
      <i class="i-lucide chevron-down"></i>
    </button>
  </div>
  <div id="copy-page-content" role="menu" aria-orientation="vertical" aria-hidden="true">
    <div role="presentation">
      <div class="flex flex-col" role="group">
        <button class="js-copy" type="button" role="menuitem"
          data-url="https://raw.githubusercontent.com/cartography-cncf/cartography/refs/heads/master/docs/root/references/orm.md.txt">
          <span class="iconify-icon">
            <i class="i-lucide" data-icon="copy"></i>
          </span>
          <span>Copy page</span>
        </button>
        <a role="menuitem" href="https://raw.githubusercontent.com/cartography-cncf/cartography/refs/heads/master/docs/root/references/orm.md.txt" target="_blank" rel="nofollow"><iconify-icon icon="bi:markdown"></iconify-icon>
            <span>View as Markdown</span></a><a role="menuitem" href="https://chatgpt.com/?hints=search&q=Read%20https%3A//raw.githubusercontent.com/cartography-cncf/cartography/refs/heads/master/docs/root/references/orm.md.txt%20so%20I%20can%20ask%20questions%20about%20it." target="_blank" rel="nofollow">
          <iconify-icon icon="bi:openai"></iconify-icon>
          <span>Open in ChatGPT</span>
        </a><a role="menuitem" href="https://claude.ai/new?q=Read%20https%3A//raw.githubusercontent.com/cartography-cncf/cartography/refs/heads/master/docs/root/references/orm.md.txt%20so%20I%20can%20ask%20questions%20about%20it." target="_blank" rel="nofollow">
          <iconify-icon icon="bi:claude"></iconify-icon>
          <span>Open in Claude</span>
        </a></div>
    </div>
  </div>
</div><article class="yue" role="main">
          <section id="orm">
<h1>ORM<a class="headerlink" href="#orm" title="Link to this heading">¶</a></h1>
<section id="module-cartography.client.core.tx">
<span id="client-tx"></span><h2>Client TX<a class="headerlink" href="#module-cartography.client.core.tx" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="cartography.client.core.tx.ensure_indexes">
<span class="sig-prename descclassname"><span class="pre">cartography.client.core.tx.</span></span><span class="sig-name descname"><span class="pre">ensure_indexes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">neo4j_session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Session</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">node_schema</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="model.html#cartography.models.core.nodes.CartographyNodeSchema" title="cartography.models.core.nodes.CartographyNodeSchema"><span class="pre">CartographyNodeSchema</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#cartography.client.core.tx.ensure_indexes" title="Link to this definition">¶</a></dt>
<dd><p>Create indexes for efficient node and relationship matching.</p>
<p>This function creates indexes for the given CartographyNodeSchema object,
including indexes for all relationships defined in its <code class="docutils literal notranslate"><span class="pre">other_relationships</span></code>
and <code class="docutils literal notranslate"><span class="pre">sub_resource_relationship</span></code> fields. This operation is idempotent and
safe to run multiple times.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>neo4j_session</strong> (<em>neo4j.Session</em>) – The Neo4j session for database operations.</p></li>
<li><p><strong>node_schema</strong> (<a class="reference internal" href="model.html#cartography.models.core.nodes.CartographyNodeSchema" title="cartography.models.core.nodes.CartographyNodeSchema"><em>CartographyNodeSchema</em></a>) – The node schema object to create
indexes for. This defines which properties need indexing.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If any generated query doesn’t start with “CREATE INDEX IF NOT EXISTS”,
    indicating a potential security issue with the query generation.</p>
</dd>
</dl>
<div class="admonition-examples admonition">
<p class="admonition-title">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="n">node_schema</span> <span class="o">=</span> <span class="n">CartographyNodeSchema</span><span class="p">(</span>
</span><span data-line="2"><span class="gp">... </span>    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;AWSUser&#39;</span><span class="p">,</span>
</span><span data-line="3"><span class="gp">... </span>    <span class="n">properties</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">PropertyRef</span><span class="p">(</span><span class="s1">&#39;UserId&#39;</span><span class="p">),</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">PropertyRef</span><span class="p">(</span><span class="s1">&#39;UserName&#39;</span><span class="p">)},</span>
</span><span data-line="4"><span class="gp">... </span>    <span class="n">sub_resource_relationship</span><span class="o">=</span><span class="n">make_target_node_matcher</span><span class="p">({</span><span class="s1">&#39;account_id&#39;</span><span class="p">:</span> <span class="n">PropertyRef</span><span class="p">(</span><span class="s1">&#39;AccountId&#39;</span><span class="p">)})</span>
</span><span data-line="5"><span class="gp">... </span><span class="p">)</span>
</span><span data-line="6"><span class="gp">&gt;&gt;&gt; </span><span class="n">ensure_indexes</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">node_schema</span><span class="p">)</span>
</span></pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>This ensures that every MATCH operation on nodes will be indexed, making
relationship creation and queries fast.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">id</span></code> and <code class="docutils literal notranslate"><span class="pre">lastupdated</span></code> properties automatically have indexes created.</p></li>
<li><p>All properties included in target node matchers automatically have indexes created.</p></li>
<li><p>This function should be called before performing any data loading operations.</p></li>
</ul>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cartography.client.core.tx.ensure_indexes_for_matchlinks">
<span class="sig-prename descclassname"><span class="pre">cartography.client.core.tx.</span></span><span class="sig-name descname"><span class="pre">ensure_indexes_for_matchlinks</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">neo4j_session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Session</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rel_schema</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="model.html#cartography.models.core.relationships.CartographyRelSchema" title="cartography.models.core.relationships.CartographyRelSchema"><span class="pre">CartographyRelSchema</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#cartography.client.core.tx.ensure_indexes_for_matchlinks" title="Link to this definition">¶</a></dt>
<dd><p>Create indexes for efficient relationship matching between existing nodes.</p>
<p>This function creates indexes for node fields referenced in the given
CartographyRelSchema object. It’s specifically designed for matchlink operations
where relationships are created between existing nodes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>neo4j_session</strong> (<em>neo4j.Session</em>) – The Neo4j session for database operations.</p></li>
<li><p><strong>rel_schema</strong> (<a class="reference internal" href="model.html#cartography.models.core.relationships.CartographyRelSchema" title="cartography.models.core.relationships.CartographyRelSchema"><em>CartographyRelSchema</em></a>) – The relationship schema object to create
indexes for. This defines which node properties need indexing for
efficient relationship matching.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If any generated query doesn’t start with “CREATE INDEX IF NOT EXISTS”,
    indicating a potential security issue with the query generation.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>This function is only used for <code class="docutils literal notranslate"><span class="pre">load_matchlinks()</span></code> operations where
we match and connect existing nodes.</p></li>
<li><p>It’s not used for CartographyNodeSchema objects - use <code class="docutils literal notranslate"><span class="pre">ensure_indexes()</span></code>
for those instead.</p></li>
</ul>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cartography.client.core.tx.execute_write_with_retry">
<span class="sig-prename descclassname"><span class="pre">cartography.client.core.tx.</span></span><span class="sig-name descname"><span class="pre">execute_write_with_retry</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">neo4j_session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Session</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tx_func</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Any</span></span></span><a class="headerlink" href="#cartography.client.core.tx.execute_write_with_retry" title="Link to this definition">¶</a></dt>
<dd><p>Execute a custom transaction function with retry logic for transient errors.</p>
<p>This is a generic wrapper for any custom transaction function that needs retry logic
for EntityNotFound and other transient errors. Use this when you have complex
transaction logic that doesn’t fit the standard load_graph_data pattern.</p>
<dl>
<dt>Example usage:</dt><dd><dl class="simple">
<dt>def my_custom_tx(tx, data_list, update_tag):</dt><dd><dl class="simple">
<dt>for item in data_list:</dt><dd><p>tx.run(query, <a href="#id1"><span class="problematic" id="id2">**</span></a>item).consume()</p>
</dd>
</dl>
</dd>
<dt>execute_write_with_retry(</dt><dd><p>neo4j_session,
my_custom_tx,
data_list,
update_tag</p>
</dd>
</dl>
<p>)</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>neo4j_session</strong> – The Neo4j session</p></li>
<li><p><strong>tx_func</strong> – The transaction function to execute (takes neo4j.Transaction as first arg)</p></li>
<li><p><strong>args</strong> – Positional arguments to pass to tx_func</p></li>
<li><p><strong>kwargs</strong> – Keyword arguments to pass to tx_func</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The return value of tx_func</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cartography.client.core.tx.load">
<span class="sig-prename descclassname"><span class="pre">cartography.client.core.tx.</span></span><span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">neo4j_session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Session</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">node_schema</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="model.html#cartography.models.core.nodes.CartographyNodeSchema" title="cartography.models.core.nodes.CartographyNodeSchema"><span class="pre">CartographyNodeSchema</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">dict_list</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">10000</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#cartography.client.core.tx.load" title="Link to this definition">¶</a></dt>
<dd><p>Load node data to the graph with automatic indexing.</p>
<p>This is the main entry point for intel modules to write node data to the graph.
It automatically ensures that required indexes exist before performing the load
operation, optimizing performance and maintaining data integrity.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>neo4j_session</strong> (<em>neo4j.Session</em>) – The Neo4j session for database operations.</p></li>
<li><p><strong>node_schema</strong> (<a class="reference internal" href="model.html#cartography.models.core.nodes.CartographyNodeSchema" title="cartography.models.core.nodes.CartographyNodeSchema"><em>CartographyNodeSchema</em></a>) – The node schema object that defines
the structure of the data being loaded and generates the ingestion query.</p></li>
<li><p><strong>dict_list</strong> (<em>List</em><em>[</em><em>Dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em><em>]</em>) – The data to load to the graph, represented
as a list of dictionaries. Each dictionary represents one node to create
or update.</p></li>
<li><p><strong>batch_size</strong> (<em>int</em>) – The number of items to process per transaction. Defaults to 10000.</p></li>
<li><p><strong>**kwargs</strong> – Additional keyword arguments passed to the Neo4j query, such as
timestamps, update tags, or other metadata.</p></li>
</ul>
</dd>
</dl>
<div class="admonition-examples admonition">
<p class="admonition-title">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="n">node_schema</span> <span class="o">=</span> <span class="n">CartographyNodeSchema</span><span class="p">(</span>
</span><span data-line="2"><span class="gp">... </span>    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;AWSUser&#39;</span><span class="p">,</span>
</span><span data-line="3"><span class="gp">... </span>    <span class="n">properties</span><span class="o">=</span><span class="p">{</span>
</span><span data-line="4"><span class="gp">... </span>        <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">PropertyRef</span><span class="p">(</span><span class="s1">&#39;UserId&#39;</span><span class="p">),</span>
</span><span data-line="5"><span class="gp">... </span>        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">PropertyRef</span><span class="p">(</span><span class="s1">&#39;UserName&#39;</span><span class="p">),</span>
</span><span data-line="6"><span class="gp">... </span>        <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="n">PropertyRef</span><span class="p">(</span><span class="s1">&#39;Email&#39;</span><span class="p">)</span>
</span><span data-line="7"><span class="gp">... </span>    <span class="p">}</span>
</span><span data-line="8"><span class="gp">... </span><span class="p">)</span>
</span><span data-line="9"><span class="gp">&gt;&gt;&gt; </span><span class="n">users_data</span> <span class="o">=</span> <span class="p">[</span>
</span><span data-line="10"><span class="gp">... </span>    <span class="p">{</span><span class="s1">&#39;UserId&#39;</span><span class="p">:</span> <span class="s1">&#39;user1&#39;</span><span class="p">,</span> <span class="s1">&#39;UserName&#39;</span><span class="p">:</span> <span class="s1">&#39;Alice&#39;</span><span class="p">,</span> <span class="s1">&#39;Email&#39;</span><span class="p">:</span> <span class="s1">&#39;alice@example.com&#39;</span><span class="p">},</span>
</span><span data-line="11"><span class="gp">... </span>    <span class="p">{</span><span class="s1">&#39;UserId&#39;</span><span class="p">:</span> <span class="s1">&#39;user2&#39;</span><span class="p">,</span> <span class="s1">&#39;UserName&#39;</span><span class="p">:</span> <span class="s1">&#39;Bob&#39;</span><span class="p">,</span> <span class="s1">&#39;Email&#39;</span><span class="p">:</span> <span class="s1">&#39;bob@example.com&#39;</span><span class="p">}</span>
</span><span data-line="12"><span class="gp">... </span><span class="p">]</span>
</span><span data-line="13"><span class="gp">&gt;&gt;&gt; </span><span class="n">load</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">node_schema</span><span class="p">,</span> <span class="n">users_data</span><span class="p">,</span> <span class="n">lastupdated</span><span class="o">=</span><span class="n">current_time</span><span class="p">)</span>
</span></pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">dict_list</span></code> is empty, the function returns early to save processing time.</p></li>
<li><p>The function automatically creates necessary indexes before loading data.</p></li>
<li><p>The ingestion query is generated automatically from the node schema.</p></li>
<li><p>Data is processed in batches for optimal performance.</p></li>
</ul>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cartography.client.core.tx.load_graph_data">
<span class="sig-prename descclassname"><span class="pre">cartography.client.core.tx.</span></span><span class="sig-name descname"><span class="pre">load_graph_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">neo4j_session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Session</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dict_list</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">10000</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#cartography.client.core.tx.load_graph_data" title="Link to this definition">¶</a></dt>
<dd><p>Load data to the graph using batched operations.</p>
<p>This function processes large datasets by splitting them into manageable batches
and executing write transactions for each batch. This approach prevents memory
issues and improves performance for large data loads.</p>
<p>This function handles retries for:
- Network errors (ConnectionResetError)
- Service unavailability (ServiceUnavailable, SessionExpired)
- Transient database errors (TransientError)
- EntityNotFound errors during concurrent operations (ClientError with specific code)
- BufferError with “cannot be re-sized” during concurrent multi-threaded operations</p>
<p>EntityNotFound errors are retried because they commonly occur during concurrent
write operations when multiple threads access the same node space. This is expected
behavior in Neo4j’s query execution pipeline, not a permanent failure.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>neo4j_session</strong> (<em>neo4j.Session</em>) – The Neo4j session for database operations.</p></li>
<li><p><strong>query</strong> (<em>str</em>) – The Neo4j write query to execute. This query should be generated
using <code class="docutils literal notranslate"><span class="pre">cartography.graph.querybuilder.build_ingestion_query()</span></code> rather
than being handwritten to ensure proper formatting and security.</p></li>
<li><p><strong>dict_list</strong> (<em>List</em><em>[</em><em>Dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em><em>]</em>) – The data to load to the graph, represented
as a list of dictionaries. Each dictionary represents one record to process.</p></li>
<li><p><strong>batch_size</strong> (<em>int</em>) – The number of items to process per transaction. Defaults to 10000.</p></li>
<li><p><strong>**kwargs</strong> – Additional keyword arguments passed to the Neo4j query.</p></li>
</ul>
</dd>
</dl>
<div class="admonition-examples admonition">
<p class="admonition-title">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Generated query from querybuilder</span>
</span><span data-line="2"><span class="gp">&gt;&gt;&gt; </span><span class="n">query</span> <span class="o">=</span> <span class="n">build_ingestion_query</span><span class="p">(</span><span class="n">node_schema</span><span class="p">)</span>
</span><span data-line="3"><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
</span><span data-line="4"><span class="gp">... </span>    <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;user1&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Alice&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="s1">&#39;alice@example.com&#39;</span><span class="p">},</span>
</span><span data-line="5"><span class="gp">... </span>    <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;user2&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Bob&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="s1">&#39;bob@example.com&#39;</span><span class="p">}</span>
</span><span data-line="6"><span class="gp">... </span><span class="p">]</span>
</span><span data-line="7"><span class="gp">&gt;&gt;&gt; </span><span class="n">load_graph_data</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">lastupdated</span><span class="o">=</span><span class="n">current_time</span><span class="p">)</span>
</span></pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Data is processed in batches of 10,000 records to optimize memory usage
and transaction performance.</p></li>
<li><p>This function is typically called by higher-level functions like <code class="docutils literal notranslate"><span class="pre">load()</span></code>
rather than directly by user code.</p></li>
</ul>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cartography.client.core.tx.load_matchlinks">
<span class="sig-prename descclassname"><span class="pre">cartography.client.core.tx.</span></span><span class="sig-name descname"><span class="pre">load_matchlinks</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">neo4j_session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Session</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rel_schema</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="model.html#cartography.models.core.relationships.CartographyRelSchema" title="cartography.models.core.relationships.CartographyRelSchema"><span class="pre">CartographyRelSchema</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">dict_list</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">10000</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#cartography.client.core.tx.load_matchlinks" title="Link to this definition">¶</a></dt>
<dd><p>Create relationships between existing nodes in the graph.</p>
<p>This is the main entry point for intel modules to write relationships between
two existing nodes. It ensures proper indexing and executes the relationship
creation query.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>neo4j_session</strong> (<em>neo4j.Session</em>) – The Neo4j session for database operations.</p></li>
<li><p><strong>rel_schema</strong> (<a class="reference internal" href="model.html#cartography.models.core.relationships.CartographyRelSchema" title="cartography.models.core.relationships.CartographyRelSchema"><em>CartographyRelSchema</em></a>) – The relationship schema object used to
generate the query and define the relationship structure.</p></li>
<li><p><strong>dict_list</strong> (<em>list</em><em>[</em><em>dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em><em>]</em>) – The data for creating relationships,
represented as a list of dictionaries. Each dictionary must contain
the source and target node identifiers.</p></li>
<li><p><strong>batch_size</strong> (<em>int</em>) – The number of items to process per transaction. Defaults to 10000.</p></li>
<li><p><strong>**kwargs</strong> – Additional keyword arguments passed to the Neo4j query.
Must include <code class="docutils literal notranslate"><span class="pre">_sub_resource_label</span></code> and <code class="docutils literal notranslate"><span class="pre">_sub_resource_id</span></code> for
cleanup queries.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If required kwargs <code class="docutils literal notranslate"><span class="pre">_sub_resource_label</span></code> or <code class="docutils literal notranslate"><span class="pre">_sub_resource_id</span></code>
    are not provided. These are needed for cleanup queries.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">dict_list</span></code> is empty, the function returns early to save processing time.</p></li>
<li><p>The function automatically ensures that required indexes exist for efficient
relationship creation.</p></li>
</ul>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cartography.client.core.tx.read_list_of_dicts_tx">
<span class="sig-prename descclassname"><span class="pre">cartography.client.core.tx.</span></span><span class="sig-name descname"><span class="pre">read_list_of_dicts_tx</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tx</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Transaction</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#cartography.client.core.tx.read_list_of_dicts_tx" title="Link to this definition">¶</a></dt>
<dd><p>Execute a Neo4j query and return results as a list of dictionaries.</p>
<p>This function converts each record from the query result into a dictionary,
making it easy to work with structured data from Neo4j.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tx</strong> (<em>neo4j.Transaction</em>) – A Neo4j read transaction object.</p></li>
<li><p><strong>query</strong> (<em>str</em>) – A Neo4j query string that returns one or more fields per record.</p></li>
<li><p><strong>**kwargs</strong> – Additional keyword arguments passed to <code class="docutils literal notranslate"><span class="pre">tx.run()</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>A list of dictionaries, where each dictionary represents</dt><dd><p>one record from the query result. Keys are the field names from the RETURN
clause, and values are the corresponding data.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>List[Dict[str, Any]]</p>
</dd>
</dl>
<div class="admonition-examples admonition">
<p class="admonition-title">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;MATCH (a:TestNode) RETURN a.name AS name, a.age AS age ORDER BY age&quot;</span>
</span><span data-line="2"><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">neo4j_session</span><span class="o">.</span><span class="n">read_transaction</span><span class="p">(</span><span class="n">read_list_of_dicts_tx</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
</span><span data-line="3"><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span data-line="4"><span class="go">[{&#39;name&#39;: &#39;Lisa&#39;, &#39;age&#39;: 8}, {&#39;name&#39;: &#39;Homer&#39;, &#39;age&#39;: 39}]</span>
</span></pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Easy iteration over structured data</span>
</span><span data-line="2"><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span data-line="3"><span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">person</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="n">person</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> years old&quot;</span><span class="p">)</span>
</span><span data-line="4"><span class="go">Lisa is 8 years old</span>
</span><span data-line="5"><span class="go">Homer is 39 years old</span>
</span></pre></div>
</div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cartography.client.core.tx.read_list_of_tuples_tx">
<span class="sig-prename descclassname"><span class="pre">cartography.client.core.tx.</span></span><span class="sig-name descname"><span class="pre">read_list_of_tuples_tx</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tx</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Transaction</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#cartography.client.core.tx.read_list_of_tuples_tx" title="Link to this definition">¶</a></dt>
<dd><p>Execute a Neo4j query and return results as a list of tuples.</p>
<p>This function converts each record from the query result into a tuple,
which is useful for unpacking values during iteration and can be more
memory-efficient than dictionaries.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tx</strong> (<em>neo4j.Transaction</em>) – A Neo4j read transaction object.</p></li>
<li><p><strong>query</strong> (<em>str</em>) – A Neo4j query string that returns one or more fields per record.</p></li>
<li><p><strong>**kwargs</strong> – Additional keyword arguments passed to <code class="docutils literal notranslate"><span class="pre">tx.run()</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>A list of tuples, where each tuple represents one</dt><dd><p>record from the query result. Values are ordered according to the
RETURN clause in the query.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>List[Tuple[Any, …]]</p>
</dd>
</dl>
<div class="admonition-examples admonition">
<p class="admonition-title">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;MATCH (a:TestNode) RETURN a.name AS name, a.age AS age ORDER BY age&quot;</span>
</span><span data-line="2"><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">neo4j_session</span><span class="o">.</span><span class="n">read_transaction</span><span class="p">(</span><span class="n">read_list_of_tuples_tx</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
</span><span data-line="3"><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span data-line="4"><span class="go">[(&#39;Lisa&#39;, 8), (&#39;Homer&#39;, 39)]</span>
</span></pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Easy unpacking during iteration</span>
</span><span data-line="2"><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span data-line="3"><span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="n">age</span><span class="si">}</span><span class="s2"> years old&quot;</span><span class="p">)</span>
</span><span data-line="4"><span class="go">Lisa is 8 years old</span>
</span><span data-line="5"><span class="go">Homer is 39 years old</span>
</span></pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The advantage of this function over <code class="docutils literal notranslate"><span class="pre">read_list_of_dicts_tx()</span></code> is that tuples
allow for easy unpacking during iteration and use less memory than dictionaries.</p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cartography.client.core.tx.read_list_of_values_tx">
<span class="sig-prename descclassname"><span class="pre">cartography.client.core.tx.</span></span><span class="sig-name descname"><span class="pre">read_list_of_values_tx</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tx</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Transaction</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#cartography.client.core.tx.read_list_of_values_tx" title="Link to this definition">¶</a></dt>
<dd><p>Execute a Neo4j query and return a list of single values.</p>
<p>This function is designed for queries that return a single field per record.
It extracts the value from each record and returns them as a list.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tx</strong> (<em>neo4j.Transaction</em>) – A Neo4j read transaction object.</p></li>
<li><p><strong>query</strong> (<em>str</em>) – A Neo4j query string that returns single values per record.
Supported: <code class="docutils literal notranslate"><span class="pre">MATCH</span> <span class="pre">(a:TestNode)</span> <span class="pre">RETURN</span> <span class="pre">a.name</span> <span class="pre">ORDER</span> <span class="pre">BY</span> <span class="pre">a.name</span></code>
Not supported: <code class="docutils literal notranslate"><span class="pre">MATCH</span> <span class="pre">(a:TestNode)</span> <span class="pre">RETURN</span> <span class="pre">a.name,</span> <span class="pre">a.age,</span> <span class="pre">a.x</span></code></p></li>
<li><p><strong>**kwargs</strong> – Additional keyword arguments passed to <code class="docutils literal notranslate"><span class="pre">tx.run()</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A list of string or integer values from the query results.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>List[Union[str, int]]</p>
</dd>
</dl>
<div class="admonition-examples admonition">
<p class="admonition-title">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;MATCH (a:TestNode) RETURN a.name ORDER BY a.name&quot;</span>
</span><span data-line="2"><span class="gp">&gt;&gt;&gt; </span><span class="n">values</span> <span class="o">=</span> <span class="n">neo4j_session</span><span class="o">.</span><span class="n">execute_read</span><span class="p">(</span><span class="n">read_list_of_values_tx</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
</span><span data-line="3"><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
</span><span data-line="4"><span class="go">[&#39;Alice&#39;, &#39;Bob&#39;, &#39;Charlie&#39;]</span>
</span></pre></div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If the query returns multiple fields per record, only the value of the first
field will be returned. This is not a supported use case - ensure your query
returns only one field per record.</p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cartography.client.core.tx.read_single_dict_tx">
<span class="sig-prename descclassname"><span class="pre">cartography.client.core.tx.</span></span><span class="sig-name descname"><span class="pre">read_single_dict_tx</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tx</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Transaction</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Any</span></span></span><a class="headerlink" href="#cartography.client.core.tx.read_single_dict_tx" title="Link to this definition">¶</a></dt>
<dd><p>Execute a Neo4j query and return a single dictionary result.</p>
<p>This function is designed for queries that return exactly one record with
multiple fields, converting the result into a dictionary.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tx</strong> (<em>neo4j.Transaction</em>) – A Neo4j read transaction object.</p></li>
<li><p><strong>query</strong> (<em>str</em>) – A Neo4j query string that returns a single record with one or
more fields. The query should match exactly one record.</p></li>
<li><p><strong>**kwargs</strong> – Additional keyword arguments passed to <code class="docutils literal notranslate"><span class="pre">tx.run()</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>A dictionary representing the single record from the query result,</dt><dd><p>or None if no record was found. Keys are field names from the RETURN
clause, and values are the corresponding data.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Any</p>
</dd>
</dl>
<div class="admonition-examples admonition">
<p class="admonition-title">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;MATCH (a:TestNode{name: &quot;Homer&quot;}) RETURN a.name AS name, a.age AS age&#39;&#39;&#39;</span>
</span><span data-line="2"><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">neo4j_session</span><span class="o">.</span><span class="n">read_transaction</span><span class="p">(</span><span class="n">read_single_dict_tx</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
</span><span data-line="3"><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span data-line="4"><span class="go">{&#39;name&#39;: &#39;Homer&#39;, &#39;age&#39;: 39}</span>
</span></pre></div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<ul class="simple">
<li><p>If the query matches multiple records, only the first record will be returned.</p></li>
<li><p>For multiple records, use <code class="docutils literal notranslate"><span class="pre">read_list_of_dicts_tx()</span></code> instead.</p></li>
<li><p>Ensure your query is specific enough to match exactly one record.</p></li>
</ul>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cartography.client.core.tx.read_single_value_tx">
<span class="sig-prename descclassname"><span class="pre">cartography.client.core.tx.</span></span><span class="sig-name descname"><span class="pre">read_single_value_tx</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tx</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Transaction</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#cartography.client.core.tx.read_single_value_tx" title="Link to this definition">¶</a></dt>
<dd><p>Execute a Neo4j query and return a single value.</p>
<p>This function is designed for queries that return exactly one value (string, integer, or None).
It’s useful for retrieving specific attributes from unique nodes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tx</strong> (<em>neo4j.Transaction</em>) – A Neo4j read transaction object.</p></li>
<li><p><strong>query</strong> (<em>str</em>) – A Neo4j query string that returns a single value. The query should
match exactly one record with one field.</p></li>
<li><p><strong>**kwargs</strong> – Additional keyword arguments passed to <code class="docutils literal notranslate"><span class="pre">tx.run()</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>The single value returned by the query, or None if</dt><dd><p>no record was found.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Optional[Union[str, int]]</p>
</dd>
</dl>
<div class="admonition-examples admonition">
<p class="admonition-title">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;MATCH (a:TestNode{name: &quot;Lisa&quot;}) RETURN a.age&#39;&#39;&#39;</span>
</span><span data-line="2"><span class="gp">&gt;&gt;&gt; </span><span class="n">value</span> <span class="o">=</span> <span class="n">neo4j_session</span><span class="o">.</span><span class="n">read_transaction</span><span class="p">(</span><span class="n">read_single_value_tx</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
</span><span data-line="3"><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span data-line="4"><span class="go">8</span>
</span></pre></div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<ul class="simple">
<li><p>If the query matches multiple records, only the first value will be returned.</p></li>
<li><p>If the query returns complex objects or dictionaries, the behavior is undefined.</p></li>
<li><p>Ensure your query is specific enough to match exactly one record.</p></li>
</ul>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>For complex return types, use <code class="docutils literal notranslate"><span class="pre">read_single_dict_tx()</span></code> or <code class="docutils literal notranslate"><span class="pre">read_list_of_dicts_tx()</span></code>.</p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cartography.client.core.tx.run_write_query">
<span class="sig-prename descclassname"><span class="pre">cartography.client.core.tx.</span></span><span class="sig-name descname"><span class="pre">run_write_query</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">neo4j_session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Session</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">parameters</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#cartography.client.core.tx.run_write_query" title="Link to this definition">¶</a></dt>
<dd><p>Execute a write query inside a managed transaction with retry logic.</p>
<p>This function now includes retry logic for:
- Network errors (ConnectionResetError)
- Service unavailability (ServiceUnavailable, SessionExpired)
- Transient database errors (TransientError)
- EntityNotFound errors during concurrent operations (specific ClientError)
- BufferError with “cannot be re-sized” during concurrent multi-threaded operations</p>
<p>Used by intel modules that run manual transactions (e.g., GCP firewalls, AWS resources).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>neo4j_session</strong> – The Neo4j session</p></li>
<li><p><strong>query</strong> – The Cypher query to execute</p></li>
<li><p><strong>parameters</strong> – Parameters to pass to the query</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cartography.client.core.tx.write_list_of_dicts_tx">
<span class="sig-prename descclassname"><span class="pre">cartography.client.core.tx.</span></span><span class="sig-name descname"><span class="pre">write_list_of_dicts_tx</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tx</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Transaction</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#cartography.client.core.tx.write_list_of_dicts_tx" title="Link to this definition">¶</a></dt>
<dd><p>Execute a Neo4j write query with a list of dictionaries.</p>
<p>This function is designed to work with queries that process batches of data
using the UNWIND clause, allowing efficient bulk operations on Neo4j.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tx</strong> (<em>neo4j.Transaction</em>) – A Neo4j write transaction object.</p></li>
<li><p><strong>query</strong> (<em>str</em>) – A Neo4j write query string that typically uses UNWIND to process
the <code class="docutils literal notranslate"><span class="pre">$DictList</span></code> parameter. The query should contain data manipulation
operations like MERGE, CREATE, or SET.</p></li>
<li><p><strong>**kwargs</strong> – Additional keyword arguments passed to the Neo4j query, including
the <code class="docutils literal notranslate"><span class="pre">DictList</span></code> parameter containing the data to process.</p></li>
</ul>
</dd>
</dl>
<div class="admonition-examples admonition">
<p class="admonition-title">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">neo4j</span>
</span><span data-line="2"><span class="gp">&gt;&gt;&gt; </span><span class="n">dict_list</span> <span class="o">=</span> <span class="p">[</span>
</span><span data-line="3"><span class="gp">... </span>    <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Alice&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">},</span>
</span><span data-line="4"><span class="gp">... </span>    <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Bob&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">25</span><span class="p">}</span>
</span><span data-line="5"><span class="gp">... </span><span class="p">]</span>
</span><span data-line="6"><span class="gp">&gt;&gt;&gt;</span>
</span><span data-line="7"><span class="gp">&gt;&gt;&gt; </span><span class="n">neo4j_session</span><span class="o">.</span><span class="n">execute_write</span><span class="p">(</span>
</span><span data-line="8"><span class="gp">... </span>    <span class="n">write_list_of_dicts_tx</span><span class="p">,</span>
</span><span data-line="9"><span class="gp">... </span><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span data-line="10"><span class="gp">... </span><span class="sd">    UNWIND $DictList as data</span>
</span><span data-line="11"><span class="gp">... </span><span class="sd">        MERGE (a:Person{id: data.id})</span>
</span><span data-line="12"><span class="gp">... </span><span class="sd">        SET</span>
</span><span data-line="13"><span class="gp">... </span><span class="sd">            a.name = data.name,</span>
</span><span data-line="14"><span class="gp">... </span><span class="sd">            a.age = data.age,</span>
</span><span data-line="15"><span class="gp">... </span><span class="sd">            a.updated_at = $timestamp</span>
</span><span data-line="16"><span class="gp">... </span><span class="sd">    &#39;&#39;&#39;</span><span class="p">,</span>
</span><span data-line="17"><span class="gp">... </span>    <span class="n">DictList</span><span class="o">=</span><span class="n">dict_list</span><span class="p">,</span>
</span><span data-line="18"><span class="gp">... </span>    <span class="n">timestamp</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span data-line="19"><span class="gp">... </span><span class="p">)</span>
</span></pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This function is typically used internally by higher-level functions like
<code class="docutils literal notranslate"><span class="pre">load_graph_data()</span></code> rather than being called directly by user code.</p>
</div>
</dd></dl>

</section>
<section id="module-cartography.graph.querybuilder">
<span id="querybuilder"></span><h2>QueryBuilder<a class="headerlink" href="#module-cartography.graph.querybuilder" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="cartography.graph.querybuilder.build_create_index_queries">
<span class="sig-prename descclassname"><span class="pre">cartography.graph.querybuilder.</span></span><span class="sig-name descname"><span class="pre">build_create_index_queries</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node_schema</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="model.html#cartography.models.core.nodes.CartographyNodeSchema" title="cartography.models.core.nodes.CartographyNodeSchema"><span class="pre">CartographyNodeSchema</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#cartography.graph.querybuilder.build_create_index_queries" title="Link to this definition">¶</a></dt>
<dd><p>Generate queries to create indexes for the given CartographyNodeSchema and all node types attached to it via its
relationships.</p>
<p>This function creates Neo4j CREATE INDEX queries for optimal query performance.
It handles indexes for the main node schema, its relationships, and any extra
labels or properties that require indexing.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>node_schema</strong> (<a class="reference internal" href="model.html#cartography.models.core.nodes.CartographyNodeSchema" title="cartography.models.core.nodes.CartographyNodeSchema"><em>CartographyNodeSchema</em></a>) – The Cartography node schema object to create indexes for.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>A list of CREATE INDEX queries of the form</dt><dd><p><cite>CREATE INDEX IF NOT EXISTS FOR (n:$TargetNodeLabel) ON (n.$TargetAttribute)</cite></p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>List[str]</p>
</dd>
</dl>
<div class="admonition-examples admonition">
<p class="admonition-title">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="n">node_schema</span> <span class="o">=</span> <span class="n">CartographyNodeSchema</span><span class="p">(</span>
</span><span data-line="2"><span class="gp">... </span>    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;AWSUser&#39;</span><span class="p">,</span>
</span><span data-line="3"><span class="gp">... </span>    <span class="n">properties</span><span class="o">=</span><span class="n">Properties</span><span class="p">(</span>
</span><span data-line="4"><span class="gp">... </span>        <span class="nb">id</span><span class="o">=</span><span class="n">PropertyRef</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">),</span>
</span><span data-line="5"><span class="gp">... </span>        <span class="n">arn</span><span class="o">=</span><span class="n">PropertyRef</span><span class="p">(</span><span class="s1">&#39;arn&#39;</span><span class="p">,</span> <span class="n">extra_index</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
</span><span data-line="6"><span class="gp">... </span>        <span class="n">name</span><span class="o">=</span><span class="n">PropertyRef</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
</span><span data-line="7"><span class="gp">... </span>    <span class="p">),</span>
</span><span data-line="8"><span class="gp">... </span>    <span class="n">sub_resource_relationship</span><span class="o">=</span><span class="n">account_rel</span><span class="p">,</span>
</span><span data-line="9"><span class="gp">... </span>    <span class="n">other_relationships</span><span class="o">=</span><span class="n">OtherRelationships</span><span class="p">([</span><span class="n">role_rel</span><span class="p">])</span>
</span><span data-line="10"><span class="gp">... </span><span class="p">)</span>
</span><span data-line="11"><span class="gp">&gt;&gt;&gt; </span><span class="n">queries</span> <span class="o">=</span> <span class="n">build_create_index_queries</span><span class="p">(</span><span class="n">node_schema</span><span class="p">)</span>
</span><span data-line="12"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Returns indexes for:</span>
</span><span data-line="13"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># - AWSUser.id and AWSUser.lastupdated (standard indexes)</span>
</span><span data-line="14"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># - AWSUser.arn (extra index due to extra_index=True)</span>
</span><span data-line="15"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># - Target node properties from relationships</span>
</span><span data-line="16"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># - Extra node labels if present</span>
</span></pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This function automatically creates indexes for ‘id’ and ‘lastupdated’ fields
on all node types, plus any properties marked with extra_index=True.
It also indexes target node properties from all relationships.</p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cartography.graph.querybuilder.build_create_index_queries_for_matchlink">
<span class="sig-prename descclassname"><span class="pre">cartography.graph.querybuilder.</span></span><span class="sig-name descname"><span class="pre">build_create_index_queries_for_matchlink</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rel_schema</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="model.html#cartography.models.core.relationships.CartographyRelSchema" title="cartography.models.core.relationships.CartographyRelSchema"><span class="pre">CartographyRelSchema</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#cartography.graph.querybuilder.build_create_index_queries_for_matchlink" title="Link to this definition">¶</a></dt>
<dd><p>Generate queries to create indexes for the given CartographyRelSchema and all node types attached to it.</p>
<p>This function creates Neo4j CREATE INDEX queries specifically for matchlink operations,
which are used to connect existing nodes in the graph. It creates indexes for both
source and target node properties, plus composite relationship indexes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>rel_schema</strong> (<a class="reference internal" href="model.html#cartography.models.core.relationships.CartographyRelSchema" title="cartography.models.core.relationships.CartographyRelSchema"><em>CartographyRelSchema</em></a>) – The CartographyRelSchema object to create indexes for.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>A list of CREATE INDEX queries for source nodes, target nodes, and relationships.</dt><dd><p>Returns empty list if source_node_matcher is not defined.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>List[str]</p>
</dd>
</dl>
<div class="admonition-examples admonition">
<p class="admonition-title">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="n">rel_schema</span> <span class="o">=</span> <span class="n">CartographyRelSchema</span><span class="p">(</span>
</span><span data-line="2"><span class="gp">... </span>    <span class="n">source_node_label</span><span class="o">=</span><span class="s1">&#39;User&#39;</span><span class="p">,</span>
</span><span data-line="3"><span class="gp">... </span>    <span class="n">source_node_matcher</span><span class="o">=</span><span class="n">SourceNodeMatcher</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">PropertyRef</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)),</span>
</span><span data-line="4"><span class="gp">... </span>    <span class="n">target_node_label</span><span class="o">=</span><span class="s1">&#39;Role&#39;</span><span class="p">,</span>
</span><span data-line="5"><span class="gp">... </span>    <span class="n">target_node_matcher</span><span class="o">=</span><span class="n">TargetNodeMatcher</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">PropertyRef</span><span class="p">(</span><span class="s1">&#39;role_name&#39;</span><span class="p">)),</span>
</span><span data-line="6"><span class="gp">... </span>    <span class="n">rel_label</span><span class="o">=</span><span class="s1">&#39;HAS_ROLE&#39;</span><span class="p">,</span>
</span><span data-line="7"><span class="gp">... </span>    <span class="n">direction</span><span class="o">=</span><span class="n">LinkDirection</span><span class="o">.</span><span class="n">OUTWARD</span>
</span><span data-line="8"><span class="gp">... </span><span class="p">)</span>
</span><span data-line="9"><span class="gp">&gt;&gt;&gt; </span><span class="n">queries</span> <span class="o">=</span> <span class="n">build_create_index_queries_for_matchlink</span><span class="p">(</span><span class="n">rel_schema</span><span class="p">)</span>
</span><span data-line="10"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Returns:</span>
</span><span data-line="11"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># - CREATE INDEX FOR (n:User) ON (n.id)</span>
</span><span data-line="12"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># - CREATE INDEX FOR (n:Role) ON (n.name)</span>
</span><span data-line="13"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># - CREATE INDEX FOR ()-[r:HAS_ROLE]-&gt;() ON (r.lastupdated, r._sub_resource_label, r._sub_resource_id)</span>
</span></pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Missing source node matcher</span>
</span><span data-line="2"><span class="gp">&gt;&gt;&gt; </span><span class="n">incomplete_rel</span> <span class="o">=</span> <span class="n">CartographyRelSchema</span><span class="p">(</span><span class="n">target_node_label</span><span class="o">=</span><span class="s1">&#39;Role&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</span><span data-line="3"><span class="gp">&gt;&gt;&gt; </span><span class="n">queries</span> <span class="o">=</span> <span class="n">build_create_index_queries_for_matchlink</span><span class="p">(</span><span class="n">incomplete_rel</span><span class="p">)</span>
</span><span data-line="4"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Returns: [] (empty list with warning logged)</span>
</span></pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This function is only used for load_matchlinks() where we match and connect
existing nodes in the graph. It requires source_node_matcher to be defined
and creates composite indexes for relationship performance.</p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cartography.graph.querybuilder.build_ingestion_query">
<span class="sig-prename descclassname"><span class="pre">cartography.graph.querybuilder.</span></span><span class="sig-name descname"><span class="pre">build_ingestion_query</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node_schema</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="model.html#cartography.models.core.nodes.CartographyNodeSchema" title="cartography.models.core.nodes.CartographyNodeSchema"><span class="pre">CartographyNodeSchema</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">selected_relationships</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">set</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="model.html#cartography.models.core.relationships.CartographyRelSchema" title="cartography.models.core.relationships.CartographyRelSchema"><span class="pre">CartographyRelSchema</span></a><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="headerlink" href="#cartography.graph.querybuilder.build_ingestion_query" title="Link to this definition">¶</a></dt>
<dd><p>Generate a Neo4j query from a CartographyNodeSchema to ingest nodes and relationships.</p>
<p>This function creates an optimized Neo4j query that cartography module authors can use
instead of handwriting their own queries. It handles node creation, property setting,
and relationship attachment in a single optimized query.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>node_schema</strong> (<a class="reference internal" href="model.html#cartography.models.core.nodes.CartographyNodeSchema" title="cartography.models.core.nodes.CartographyNodeSchema"><em>CartographyNodeSchema</em></a>) – The CartographyNodeSchema object to build a Neo4j query from.</p></li>
<li><p><strong>selected_relationships</strong> (<em>Optional</em><em>[</em><em>Set</em><em>[</em><a class="reference internal" href="model.html#cartography.models.core.relationships.CartographyRelSchema" title="cartography.models.core.relationships.CartographyRelSchema"><em>CartographyRelSchema</em></a><em>]</em><em>]</em><em>, </em><em>optional</em>) – If specified, generates
a query that attaches only the relationships in this set. The RelSchema specified must be
present in node_schema.sub_resource_relationship or node_schema.other_relationships.
Defaults to None (uses all relationships). If empty set, creates query with no relationships.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>An optimized Neo4j query that can be used to ingest nodes and relationships.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
<div class="admonition-examples admonition">
<p class="admonition-title">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Basic node schema with relationships</span>
</span><span data-line="2"><span class="gp">&gt;&gt;&gt; </span><span class="n">node_schema</span> <span class="o">=</span> <span class="n">CartographyNodeSchema</span><span class="p">(</span>
</span><span data-line="3"><span class="gp">... </span>    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;EC2Instance&#39;</span><span class="p">,</span>
</span><span data-line="4"><span class="gp">... </span>    <span class="n">properties</span><span class="o">=</span><span class="n">EC2InstanceProperties</span><span class="p">(),</span>
</span><span data-line="5"><span class="gp">... </span>    <span class="n">sub_resource_relationship</span><span class="o">=</span><span class="n">account_rel</span><span class="p">,</span>
</span><span data-line="6"><span class="gp">... </span>    <span class="n">other_relationships</span><span class="o">=</span><span class="n">OtherRelationships</span><span class="p">([</span><span class="n">vpc_rel</span><span class="p">,</span> <span class="n">subnet_rel</span><span class="p">])</span>
</span><span data-line="7"><span class="gp">... </span><span class="p">)</span>
</span><span data-line="8"><span class="gp">&gt;&gt;&gt; </span><span class="n">query</span> <span class="o">=</span> <span class="n">build_ingestion_query</span><span class="p">(</span><span class="n">node_schema</span><span class="p">)</span>
</span><span data-line="9"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Returns complete ingestion query with all relationships</span>
</span></pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Query with selected relationships only</span>
</span><span data-line="2"><span class="gp">&gt;&gt;&gt; </span><span class="n">selected_rels</span> <span class="o">=</span> <span class="p">{</span><span class="n">account_rel</span><span class="p">,</span> <span class="n">vpc_rel</span><span class="p">}</span>
</span><span data-line="3"><span class="gp">&gt;&gt;&gt; </span><span class="n">query</span> <span class="o">=</span> <span class="n">build_ingestion_query</span><span class="p">(</span><span class="n">node_schema</span><span class="p">,</span> <span class="n">selected_rels</span><span class="p">)</span>
</span><span data-line="4"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Returns query with only account and VPC relationships</span>
</span></pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Query with no relationships</span>
</span><span data-line="2"><span class="gp">&gt;&gt;&gt; </span><span class="n">query</span> <span class="o">=</span> <span class="n">build_ingestion_query</span><span class="p">(</span><span class="n">node_schema</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>
</span><span data-line="3"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Returns query that only creates nodes, no relationships</span>
</span></pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The resulting query uses the UNWIND + MERGE pattern for batch loading data efficiently</p></li>
<li><p>The query assumes a list of dicts will be passed via parameter $DictList</p></li>
<li><p>The query sets <cite>firstseen</cite> attributes on all created nodes and relationships</p></li>
<li><p>The query is intended for use with cartography.core.client.tx.load_graph_data()</p></li>
</ul>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cartography.graph.querybuilder.build_matchlink_query">
<span class="sig-prename descclassname"><span class="pre">cartography.graph.querybuilder.</span></span><span class="sig-name descname"><span class="pre">build_matchlink_query</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rel_schema</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="model.html#cartography.models.core.relationships.CartographyRelSchema" title="cartography.models.core.relationships.CartographyRelSchema"><span class="pre">CartographyRelSchema</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="headerlink" href="#cartography.graph.querybuilder.build_matchlink_query" title="Link to this definition">¶</a></dt>
<dd><p>Generate a Neo4j query to link two existing nodes when given a CartographyRelSchema object.</p>
<p>This function creates a Neo4j query specifically for connecting existing nodes in the graph
based on their properties. It is designed for use with load_matchlinks() operations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>rel_schema</strong> (<a class="reference internal" href="model.html#cartography.models.core.relationships.CartographyRelSchema" title="cartography.models.core.relationships.CartographyRelSchema"><em>CartographyRelSchema</em></a>) – The CartographyRelSchema object to generate a query for.
This object must have:
- source_node_matcher and source_node_label defined
- CartographyRelProperties with _sub_resource_label and _sub_resource_id defined</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A Neo4j query that can be used to link two existing nodes.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If the rel_schema does not have a source_node_matcher or source_node_label defined,
    or if the rel_schema properties do not have _sub_resource_label or _sub_resource_id defined.</p>
</dd>
</dl>
<div class="admonition-examples admonition">
<p class="admonition-title">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="n">rel_schema</span> <span class="o">=</span> <span class="n">CartographyRelSchema</span><span class="p">(</span>
</span><span data-line="2"><span class="gp">... </span>    <span class="n">source_node_label</span><span class="o">=</span><span class="s1">&#39;User&#39;</span><span class="p">,</span>
</span><span data-line="3"><span class="gp">... </span>    <span class="n">source_node_matcher</span><span class="o">=</span><span class="n">SourceNodeMatcher</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">PropertyRef</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)),</span>
</span><span data-line="4"><span class="gp">... </span>    <span class="n">target_node_label</span><span class="o">=</span><span class="s1">&#39;Role&#39;</span><span class="p">,</span>
</span><span data-line="5"><span class="gp">... </span>    <span class="n">target_node_matcher</span><span class="o">=</span><span class="n">TargetNodeMatcher</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">PropertyRef</span><span class="p">(</span><span class="s1">&#39;role_name&#39;</span><span class="p">)),</span>
</span><span data-line="6"><span class="gp">... </span>    <span class="n">rel_label</span><span class="o">=</span><span class="s1">&#39;HAS_ROLE&#39;</span><span class="p">,</span>
</span><span data-line="7"><span class="gp">... </span>    <span class="n">direction</span><span class="o">=</span><span class="n">LinkDirection</span><span class="o">.</span><span class="n">OUTWARD</span><span class="p">,</span>
</span><span data-line="8"><span class="gp">... </span>    <span class="n">properties</span><span class="o">=</span><span class="n">UserRoleRel</span><span class="p">(</span>
</span><span data-line="9"><span class="gp">... </span>        <span class="n">_sub_resource_label</span><span class="o">=</span><span class="n">PropertyRef</span><span class="p">(</span><span class="s1">&#39;_sub_resource_label&#39;</span><span class="p">,</span> <span class="n">set_in_kwargs</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
</span><span data-line="10"><span class="gp">... </span>        <span class="n">_sub_resource_id</span><span class="o">=</span><span class="n">PropertyRef</span><span class="p">(</span><span class="s1">&#39;_sub_resource_id&#39;</span><span class="p">,</span> <span class="n">set_in_kwargs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="11"><span class="gp">... </span>    <span class="p">)</span>
</span><span data-line="12"><span class="gp">... </span><span class="p">)</span>
</span><span data-line="13"><span class="gp">&gt;&gt;&gt; </span><span class="n">query</span> <span class="o">=</span> <span class="n">build_matchlink_query</span><span class="p">(</span><span class="n">rel_schema</span><span class="p">)</span>
</span><span data-line="14"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Returns:</span>
</span><span data-line="15"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># UNWIND $DictList as item</span>
</span><span data-line="16"><span class="gp">&gt;&gt;&gt; </span><span class="c1">#     MATCH (from:User{id: item.user_id})</span>
</span><span data-line="17"><span class="gp">&gt;&gt;&gt; </span><span class="c1">#     MATCH (to:Role{name: item.role_name})</span>
</span><span data-line="18"><span class="gp">&gt;&gt;&gt; </span><span class="c1">#     MERGE (from)-[r:HAS_ROLE]-&gt;(to)</span>
</span><span data-line="19"><span class="gp">&gt;&gt;&gt; </span><span class="c1">#     ON CREATE SET r.firstseen = timestamp()</span>
</span><span data-line="20"><span class="gp">&gt;&gt;&gt; </span><span class="c1">#     SET r._sub_resource_label = $_sub_resource_label, ...</span>
</span></pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This function is only used for load_matchlinks() operations where we need to
connect existing nodes. The _sub_resource_label and _sub_resource_id properties
are required for the cleanup query functionality.</p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cartography.graph.querybuilder.filter_selected_relationships">
<span class="sig-prename descclassname"><span class="pre">cartography.graph.querybuilder.</span></span><span class="sig-name descname"><span class="pre">filter_selected_relationships</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node_schema</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="model.html#cartography.models.core.nodes.CartographyNodeSchema" title="cartography.models.core.nodes.CartographyNodeSchema"><span class="pre">CartographyNodeSchema</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">selected_relationships</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">set</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="model.html#cartography.models.core.relationships.CartographyRelSchema" title="cartography.models.core.relationships.CartographyRelSchema"><span class="pre">CartographyRelSchema</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="model.html#cartography.models.core.relationships.CartographyRelSchema" title="cartography.models.core.relationships.CartographyRelSchema"><span class="pre">CartographyRelSchema</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="model.html#cartography.models.core.relationships.OtherRelationships" title="cartography.models.core.relationships.OtherRelationships"><span class="pre">OtherRelationships</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#cartography.graph.querybuilder.filter_selected_relationships" title="Link to this definition">¶</a></dt>
<dd><p>Filter and validate selected relationships against a node schema.</p>
<p>This function ensures that selected relationships specified to build_ingestion_query()
are actually present on the node schema. It validates the relationships exist and
separates them into sub resource and other relationship categories.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>node_schema</strong> (<a class="reference internal" href="model.html#cartography.models.core.nodes.CartographyNodeSchema" title="cartography.models.core.nodes.CartographyNodeSchema"><em>CartographyNodeSchema</em></a>) – The node schema object to filter relationships against.</p></li>
<li><p><strong>selected_relationships</strong> (<em>Set</em><em>[</em><a class="reference internal" href="model.html#cartography.models.core.relationships.CartographyRelSchema" title="cartography.models.core.relationships.CartographyRelSchema"><em>CartographyRelSchema</em></a><em>]</em>) – The set of relationships to check
if they exist in the node schema. If empty set, this means no relationships have
been selected. None is not an accepted value.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>A tuple containing:</dt><dd><ul class="simple">
<li><p>Sub resource relationship (if present in selected_relationships)</p></li>
<li><p>OtherRelationships object containing all other relationships from
selected_relationships that are present in the node schema</p></li>
</ul>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Tuple[Optional[<a class="reference internal" href="model.html#cartography.models.core.relationships.CartographyRelSchema" title="cartography.models.core.relationships.CartographyRelSchema">CartographyRelSchema</a>], Optional[<a class="reference internal" href="model.html#cartography.models.core.relationships.OtherRelationships" title="cartography.models.core.relationships.OtherRelationships">OtherRelationships</a>]]</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If any selected relationship is not defined on the node schema.</p>
</dd>
</dl>
<div class="admonition-examples admonition">
<p class="admonition-title">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="n">node_schema</span> <span class="o">=</span> <span class="n">CartographyNodeSchema</span><span class="p">(</span>
</span><span data-line="2"><span class="gp">... </span>    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;EC2Instance&#39;</span><span class="p">,</span>
</span><span data-line="3"><span class="gp">... </span>    <span class="n">sub_resource_relationship</span><span class="o">=</span><span class="n">account_rel</span><span class="p">,</span>
</span><span data-line="4"><span class="gp">... </span>    <span class="n">other_relationships</span><span class="o">=</span><span class="n">OtherRelationships</span><span class="p">([</span><span class="n">vpc_rel</span><span class="p">,</span> <span class="n">subnet_rel</span><span class="p">])</span>
</span><span data-line="5"><span class="gp">... </span><span class="p">)</span>
</span><span data-line="6"><span class="gp">&gt;&gt;&gt;</span>
</span><span data-line="7"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Select subset of relationships</span>
</span><span data-line="8"><span class="gp">&gt;&gt;&gt; </span><span class="n">selected</span> <span class="o">=</span> <span class="p">{</span><span class="n">account_rel</span><span class="p">,</span> <span class="n">vpc_rel</span><span class="p">}</span>
</span><span data-line="9"><span class="gp">&gt;&gt;&gt; </span><span class="n">sub_rel</span><span class="p">,</span> <span class="n">other_rels</span> <span class="o">=</span> <span class="n">filter_selected_relationships</span><span class="p">(</span><span class="n">node_schema</span><span class="p">,</span> <span class="n">selected</span><span class="p">)</span>
</span><span data-line="10"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Returns: (account_rel, OtherRelationships([vpc_rel]))</span>
</span></pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Empty set means no relationships selected</span>
</span><span data-line="2"><span class="gp">&gt;&gt;&gt; </span><span class="n">sub_rel</span><span class="p">,</span> <span class="n">other_rels</span> <span class="o">=</span> <span class="n">filter_selected_relationships</span><span class="p">(</span><span class="n">node_schema</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>
</span><span data-line="3"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Returns: (None, None)</span>
</span></pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Invalid relationship raises error</span>
</span><span data-line="2"><span class="gp">&gt;&gt;&gt; </span><span class="n">invalid_selected</span> <span class="o">=</span> <span class="p">{</span><span class="n">unknown_rel</span><span class="p">}</span>
</span><span data-line="3"><span class="gp">&gt;&gt;&gt; </span><span class="n">filter_selected_relationships</span><span class="p">(</span><span class="n">node_schema</span><span class="p">,</span> <span class="n">invalid_selected</span><span class="p">)</span>
</span><span data-line="4"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Raises: ValueError</span>
</span></pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This function is used internally by build_ingestion_query() to validate
and filter the selected_relationships parameter.</p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cartography.graph.querybuilder.rel_present_on_node_schema">
<span class="sig-prename descclassname"><span class="pre">cartography.graph.querybuilder.</span></span><span class="sig-name descname"><span class="pre">rel_present_on_node_schema</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node_schema</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="model.html#cartography.models.core.nodes.CartographyNodeSchema" title="cartography.models.core.nodes.CartographyNodeSchema"><span class="pre">CartographyNodeSchema</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">rel_schema</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="model.html#cartography.models.core.relationships.CartographyRelSchema" title="cartography.models.core.relationships.CartographyRelSchema"><span class="pre">CartographyRelSchema</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#cartography.graph.querybuilder.rel_present_on_node_schema" title="Link to this definition">¶</a></dt>
<dd><p>Check if a relationship schema is present on a node schema.</p>
<p>This function determines whether a given relationship schema is defined
on the provided node schema, checking both sub resource relationships
and other relationships.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>node_schema</strong> (<a class="reference internal" href="model.html#cartography.models.core.nodes.CartographyNodeSchema" title="cartography.models.core.nodes.CartographyNodeSchema"><em>CartographyNodeSchema</em></a>) – The node schema to check for the relationship.</p></li>
<li><p><strong>rel_schema</strong> (<a class="reference internal" href="model.html#cartography.models.core.relationships.CartographyRelSchema" title="cartography.models.core.relationships.CartographyRelSchema"><em>CartographyRelSchema</em></a>) – The relationship schema to look for.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if the relationship schema is present on the node schema, False otherwise.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
<div class="admonition-examples admonition">
<p class="admonition-title">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="n">node_schema</span> <span class="o">=</span> <span class="n">CartographyNodeSchema</span><span class="p">(</span>
</span><span data-line="2"><span class="gp">... </span>    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;AWSUser&#39;</span><span class="p">,</span>
</span><span data-line="3"><span class="gp">... </span>    <span class="n">sub_resource_relationship</span><span class="o">=</span><span class="n">account_rel</span><span class="p">,</span>
</span><span data-line="4"><span class="gp">... </span>    <span class="n">other_relationships</span><span class="o">=</span><span class="n">OtherRelationships</span><span class="p">([</span><span class="n">role_rel</span><span class="p">,</span> <span class="n">group_rel</span><span class="p">])</span>
</span><span data-line="5"><span class="gp">... </span><span class="p">)</span>
</span><span data-line="6"><span class="gp">&gt;&gt;&gt; </span><span class="n">rel_present_on_node_schema</span><span class="p">(</span><span class="n">node_schema</span><span class="p">,</span> <span class="n">account_rel</span><span class="p">)</span>
</span><span data-line="7"><span class="go">True</span>
</span><span data-line="8"><span class="gp">&gt;&gt;&gt; </span><span class="n">rel_present_on_node_schema</span><span class="p">(</span><span class="n">node_schema</span><span class="p">,</span> <span class="n">role_rel</span><span class="p">)</span>
</span><span data-line="9"><span class="go">True</span>
</span><span data-line="10"><span class="gp">&gt;&gt;&gt; </span><span class="n">rel_present_on_node_schema</span><span class="p">(</span><span class="n">node_schema</span><span class="p">,</span> <span class="n">unknown_rel</span><span class="p">)</span>
</span><span data-line="11"><span class="go">False</span>
</span></pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This function is commonly used for validation in cleanup operations and
query building to ensure that only valid relationships are processed.</p>
</div>
</dd></dl>

</section>
<section id="module-cartography.graph.cleanupbuilder">
<span id="cleanupbuilder"></span><h2>CleanupBuilder<a class="headerlink" href="#module-cartography.graph.cleanupbuilder" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="cartography.graph.cleanupbuilder.build_cleanup_queries">
<span class="sig-prename descclassname"><span class="pre">cartography.graph.cleanupbuilder.</span></span><span class="sig-name descname"><span class="pre">build_cleanup_queries</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node_schema</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="model.html#cartography.models.core.nodes.CartographyNodeSchema" title="cartography.models.core.nodes.CartographyNodeSchema"><span class="pre">CartographyNodeSchema</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">cascade_delete</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#cartography.graph.cleanupbuilder.build_cleanup_queries" title="Link to this definition">¶</a></dt>
<dd><p>Generate Neo4j queries to clean up stale nodes and relationships.</p>
<p>This function creates appropriate cleanup queries based on the node schema’s
configuration, handling different scenarios for scoped and unscoped cleanup
operations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>node_schema</strong> (<a class="reference internal" href="model.html#cartography.models.core.nodes.CartographyNodeSchema" title="cartography.models.core.nodes.CartographyNodeSchema"><em>CartographyNodeSchema</em></a>) – The node schema object defining the
structure and cleanup behavior for the target nodes.</p></li>
<li><p><strong>cascade_delete</strong> (<em>bool</em>) – If True, also delete all child nodes that have a
relationship to stale nodes matching node_schema.sub_resource_relationship.rel_label.
Defaults to False to preserve existing behavior. Only valid when scoped_cleanup=True.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>A list of Neo4j queries to clean up stale nodes and relationships.</dt><dd><p>Returns an empty list if the node has no relationships (e.g., SyncMetadata nodes).</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>List[str]</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If the node schema has a sub resource relationship but
    <code class="docutils literal notranslate"><span class="pre">scoped_cleanup</span></code> is False, which creates an inconsistent configuration.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The function handles four distinct cases:</p>
<ol class="arabic simple">
<li><p><strong>Standard scoped cleanup</strong>: Node has sub resource + scoped cleanup = True
→ Clean up stale nodes scoped to the sub resource</p></li>
<li><p><strong>Invalid configuration</strong>: Node has sub resource + scoped cleanup = False
→ Raises ValueError (inconsistent state)</p></li>
<li><p><strong>Relationship-only cleanup</strong>: No sub resource + scoped cleanup = True
→ Clean up only stale relationships, preserve nodes</p></li>
<li><p><strong>Unscoped cleanup</strong>: No sub resource + scoped cleanup = False
→ Clean up all stale nodes regardless of scope</p></li>
</ol>
<p>Nodes without relationships (like SyncMetadata) are left for manual management.</p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cartography.graph.cleanupbuilder.build_cleanup_query_for_matchlink">
<span class="sig-prename descclassname"><span class="pre">cartography.graph.cleanupbuilder.</span></span><span class="sig-name descname"><span class="pre">build_cleanup_query_for_matchlink</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rel_schema</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="model.html#cartography.models.core.relationships.CartographyRelSchema" title="cartography.models.core.relationships.CartographyRelSchema"><span class="pre">CartographyRelSchema</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="headerlink" href="#cartography.graph.cleanupbuilder.build_cleanup_query_for_matchlink" title="Link to this definition">¶</a></dt>
<dd><p>Generate a cleanup query for matchlink relationships.</p>
<p>This function creates a Neo4j query to clean up stale matchlink relationships
that are scoped to specific sub resources. It’s used to maintain data consistency
by removing outdated relationship connections.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>rel_schema</strong> (<a class="reference internal" href="model.html#cartography.models.core.relationships.CartographyRelSchema" title="cartography.models.core.relationships.CartographyRelSchema"><em>CartographyRelSchema</em></a>) – <p>The relationship schema object to generate
a query for. Must have the following requirements:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">source_node_matcher</span></code> and <code class="docutils literal notranslate"><span class="pre">source_node_label</span></code> defined</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CartographyRelProperties</span></code> object with <code class="docutils literal notranslate"><span class="pre">_sub_resource_label</span></code> and
<code class="docutils literal notranslate"><span class="pre">_sub_resource_id</span></code> defined</p></li>
</ul>
</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>A Neo4j query to clean up stale matchlink relationships, scoped to</dt><dd><p>the specified sub resource.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If the <code class="docutils literal notranslate"><span class="pre">rel_schema</span></code> does not have a <code class="docutils literal notranslate"><span class="pre">source_node_matcher</span></code> defined.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The query includes scoping clauses to ensure only relationships associated
with the specified sub resource are cleaned up.</p></li>
<li><p>Relationship direction is automatically determined from the schema configuration.</p></li>
<li><p>The query uses parameterized values for security and consistency.</p></li>
</ul>
</div>
</dd></dl>

</section>
<section id="module-cartography.graph.job">
<span id="graphjob"></span><h2>GraphJob<a class="headerlink" href="#module-cartography.graph.job" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="cartography.graph.job.GraphJob">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">cartography.graph.job.</span></span><span class="sig-name descname"><span class="pre">GraphJob</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">statements</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#cartography.graph.statement.GraphStatement" title="cartography.graph.statement.GraphStatement"><span class="pre">GraphStatement</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">short_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cartography.graph.job.GraphJob" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A job that executes a sequence of Neo4j statements against the cartography graph.</p>
<p>A GraphJob represents a complete unit of work that consists of one or more
GraphStatements executed sequentially. Jobs are commonly used for data loading,
cleanup operations, and complex graph transformations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<em>str</em>) – Human-readable name for the job (e.g., “AWS EC2 instance cleanup”).</p></li>
<li><p><strong>statements</strong> (<em>List</em><em>[</em><a class="reference internal" href="#cartography.graph.statement.GraphStatement" title="cartography.graph.statement.GraphStatement"><em>GraphStatement</em></a><em>]</em>) – List of GraphStatement objects to execute
in sequence.</p></li>
<li><p><strong>short_name</strong> (<em>Optional</em><em>[</em><em>str</em><em>]</em>) – Short identifier/slug for the job (e.g., “ec2_cleanup”).
If not provided, logging will use the full name.</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="cartography.graph.job.GraphJob.name">
<span class="sig-name descname"><span class="pre">name</span></span><a class="headerlink" href="#cartography.graph.job.GraphJob.name" title="Link to this definition">¶</a></dt>
<dd><p>The human-readable job name.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="cartography.graph.job.GraphJob.statements">
<span class="sig-name descname"><span class="pre">statements</span></span><a class="headerlink" href="#cartography.graph.job.GraphJob.statements" title="Link to this definition">¶</a></dt>
<dd><p>The list of statements to execute.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>List[<a class="reference internal" href="#cartography.graph.statement.GraphStatement" title="cartography.graph.statement.GraphStatement">GraphStatement</a>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="cartography.graph.job.GraphJob.short_name">
<span class="sig-name descname"><span class="pre">short_name</span></span><a class="headerlink" href="#cartography.graph.job.GraphJob.short_name" title="Link to this definition">¶</a></dt>
<dd><p>The job’s short identifier for logging.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Optional[str]</p>
</dd>
</dl>
</dd></dl>

<div class="admonition-examples admonition">
<p class="admonition-title">Examples</p>
<p>Creating a simple job:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">cartography.graph.statement</span><span class="w"> </span><span class="kn">import</span> <span class="n">GraphStatement</span>
</span><span data-line="2"><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt1</span> <span class="o">=</span> <span class="n">GraphStatement</span><span class="p">(</span><span class="s2">&quot;MATCH (n:TestNode) SET n.processed = true&quot;</span><span class="p">)</span>
</span><span data-line="3"><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt2</span> <span class="o">=</span> <span class="n">GraphStatement</span><span class="p">(</span><span class="s2">&quot;MATCH (n:TestNode) WHERE n.stale = true DELETE n&quot;</span><span class="p">)</span>
</span><span data-line="4"><span class="gp">&gt;&gt;&gt; </span><span class="n">job</span> <span class="o">=</span> <span class="n">GraphJob</span><span class="p">(</span><span class="s2">&quot;Test cleanup job&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">stmt1</span><span class="p">,</span> <span class="n">stmt2</span><span class="p">],</span> <span class="s2">&quot;test_cleanup&quot;</span><span class="p">)</span>
</span><span data-line="5"><span class="gp">&gt;&gt;&gt; </span><span class="n">job</span><span class="o">.</span><span class="n">name</span>
</span><span data-line="6"><span class="go">&#39;Test cleanup job&#39;</span>
</span><span data-line="7"><span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">statements</span><span class="p">)</span>
</span><span data-line="8"><span class="go">2</span>
</span></pre></div>
</div>
<p>Creating a job from a node schema:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;UPDATE_TAG&quot;</span><span class="p">:</span> <span class="mi">1642784400</span><span class="p">,</span> <span class="s2">&quot;account_id&quot;</span><span class="p">:</span> <span class="s2">&quot;123456789012&quot;</span><span class="p">}</span>
</span><span data-line="2"><span class="gp">&gt;&gt;&gt; </span><span class="n">job</span> <span class="o">=</span> <span class="n">GraphJob</span><span class="o">.</span><span class="n">from_node_schema</span><span class="p">(</span><span class="n">aws_ec2_schema</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>
</span><span data-line="3"><span class="gp">&gt;&gt;&gt; </span><span class="n">job</span><span class="o">.</span><span class="n">name</span>
</span><span data-line="4"><span class="go">&#39;Cleanup AWSEC2Instance&#39;</span>
</span></pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Statements are executed in the order they appear in the list.</p></li>
<li><p>If any statement fails, the entire job fails and subsequent statements are not executed.</p></li>
<li><p>Jobs automatically handle parameter merging and provide structured logging.</p></li>
</ul>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="cartography.graph.job.GraphJob.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">statements</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#cartography.graph.statement.GraphStatement" title="cartography.graph.statement.GraphStatement"><span class="pre">GraphStatement</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">short_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cartography.graph.job.GraphJob.__init__" title="Link to this definition">¶</a></dt>
<dd><p>Initialize a new GraphJob instance.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<em>str</em>) – Human-readable name for the job.</p></li>
<li><p><strong>statements</strong> (<em>List</em><em>[</em><a class="reference internal" href="#cartography.graph.statement.GraphStatement" title="cartography.graph.statement.GraphStatement"><em>GraphStatement</em></a><em>]</em>) – List of statements to execute sequentially.</p></li>
<li><p><strong>short_name</strong> (<em>Optional</em><em>[</em><em>str</em><em>]</em>) – Short identifier for logging purposes.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="cartography.graph.job.GraphJob.as_dict">
<span class="sig-name descname"><span class="pre">as_dict</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span></span></span><a class="headerlink" href="#cartography.graph.job.GraphJob.as_dict" title="Link to this definition">¶</a></dt>
<dd><p>Convert the job to a dictionary representation.</p>
<p>This method serializes the job to a dictionary format suitable for JSON
serialization or other forms of persistence.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>A dictionary containing the job’s name, statements, and short_name.</dt><dd><p>The statements are also converted to their dictionary representations.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>Dict</p>
</dd>
</dl>
<div class="admonition-examples admonition">
<p class="admonition-title">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="n">job</span> <span class="o">=</span> <span class="n">GraphJob</span><span class="p">(</span><span class="s2">&quot;Test job&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">statement</span><span class="p">],</span> <span class="s2">&quot;test_job&quot;</span><span class="p">)</span>
</span><span data-line="2"><span class="gp">&gt;&gt;&gt; </span><span class="n">job_dict</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
</span><span data-line="3"><span class="gp">&gt;&gt;&gt; </span><span class="n">job_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span data-line="4"><span class="go">dict_keys([&#39;name&#39;, &#39;statements&#39;, &#39;short_name&#39;])</span>
</span><span data-line="5"><span class="gp">&gt;&gt;&gt; </span><span class="n">job_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
</span><span data-line="6"><span class="go">&#39;Test job&#39;</span>
</span></pre></div>
</div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="cartography.graph.job.GraphJob.from_json">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_json</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">blob</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">short_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#cartography.graph.job.GraphJob" title="cartography.graph.job.GraphJob"><span class="pre">GraphJob</span></a></span></span><a class="headerlink" href="#cartography.graph.job.GraphJob.from_json" title="Link to this definition">¶</a></dt>
<dd><p>Create a GraphJob instance from a JSON string.</p>
<p>This class method deserializes a JSON string into a GraphJob object,
reconstructing all statements and their parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>blob</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>dict</em><em>]</em>) – The JSON string or dictionary to deserialize. Must contain a ‘name’ field
and a ‘statements’ field with a list of statement definitions. If a string is provided,
it will be parsed as JSON. If a dictionary is provided, it will be used directly.</p></li>
<li><p><strong>short_name</strong> (<em>Optional</em><em>[</em><em>str</em><em>]</em>) – Override the short name for the job.
If not provided, uses the short_name from JSON if available.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A new GraphJob instance created from the JSON data.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#cartography.graph.job.GraphJob" title="cartography.graph.job.GraphJob">GraphJob</a></p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>json.JSONDecodeError</strong> – If the blob is not valid JSON.</p></li>
<li><p><strong>KeyError</strong> – If the JSON doesn’t contain required fields (‘name’, ‘statements’).</p></li>
</ul>
</dd>
</dl>
<div class="admonition-examples admonition">
<p class="admonition-title">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="n">json_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
</span><span data-line="2"><span class="gp">... </span><span class="s1">{</span>
</span><span data-line="3"><span class="gp">... </span><span class="s1">    &quot;name&quot;: &quot;Test Job&quot;,</span>
</span><span data-line="4"><span class="gp">... </span><span class="s1">    &quot;statements&quot;: [</span>
</span><span data-line="5"><span class="gp">... </span><span class="s1">        {</span>
</span><span data-line="6"><span class="gp">... </span><span class="s1">            &quot;query&quot;: &quot;MATCH (n:TestNode) RETURN count(n)&quot;,</span>
</span><span data-line="7"><span class="gp">... </span><span class="s1">            &quot;parameters&quot;: </span><span class="si">{}</span>
</span><span data-line="8"><span class="gp">... </span><span class="s1">        }</span>
</span><span data-line="9"><span class="gp">... </span><span class="s1">    ]</span>
</span><span data-line="10"><span class="gp">... </span><span class="s1">}</span>
</span><span data-line="11"><span class="gp">... </span><span class="s1">&#39;&#39;&#39;</span>
</span><span data-line="12"><span class="gp">&gt;&gt;&gt; </span><span class="n">job</span> <span class="o">=</span> <span class="n">GraphJob</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">json_str</span><span class="p">,</span> <span class="s2">&quot;test_job&quot;</span><span class="p">)</span>
</span><span data-line="13"><span class="gp">&gt;&gt;&gt; </span><span class="n">job</span><span class="o">.</span><span class="n">name</span>
</span><span data-line="14"><span class="go">&#39;Test Job&#39;</span>
</span><span data-line="15"><span class="gp">&gt;&gt;&gt; </span><span class="n">job</span><span class="o">.</span><span class="n">short_name</span>
</span><span data-line="16"><span class="go">&#39;test_job&#39;</span>
</span></pre></div>
</div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="cartography.graph.job.GraphJob.from_json_file">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_json_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Path</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#cartography.graph.job.GraphJob" title="cartography.graph.job.GraphJob"><span class="pre">GraphJob</span></a></span></span><a class="headerlink" href="#cartography.graph.job.GraphJob.from_json_file" title="Link to this definition">¶</a></dt>
<dd><p>Create a GraphJob instance from a JSON file.</p>
<p>This class method reads a JSON file and deserializes it into a GraphJob object.
The job’s short name is automatically derived from the file path.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>file_path</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>Path</em><em>]</em>) – The path to the JSON file to read and parse.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A new GraphJob instance created from the JSON file.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#cartography.graph.job.GraphJob" title="cartography.graph.job.GraphJob">GraphJob</a></p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>FileNotFoundError</strong> – If the specified file does not exist.</p></li>
<li><p><strong>json.JSONDecodeError</strong> – If the file contains invalid JSON.</p></li>
<li><p><strong>KeyError</strong> – If the JSON file doesn’t contain required fields (‘name’, ‘statements’).</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="cartography.graph.job.GraphJob.from_matchlink">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_matchlink</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rel_schema</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="model.html#cartography.models.core.relationships.CartographyRelSchema" title="cartography.models.core.relationships.CartographyRelSchema"><span class="pre">CartographyRelSchema</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">sub_resource_label</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sub_resource_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">update_tag</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iterationsize</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">100</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#cartography.graph.job.GraphJob" title="cartography.graph.job.GraphJob"><span class="pre">GraphJob</span></a></span></span><a class="headerlink" href="#cartography.graph.job.GraphJob.from_matchlink" title="Link to this definition">¶</a></dt>
<dd><p>Create a cleanup job for matchlink relationships.</p>
<p>This class method generates a cleanup job specifically for cleaning up stale
relationships created by <code class="docutils literal notranslate"><span class="pre">load_matchlinks()</span></code> operations. It should only be used
for matchlink cleanup and not for general relationship cleanup.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rel_schema</strong> (<a class="reference internal" href="model.html#cartography.models.core.relationships.CartographyRelSchema" title="cartography.models.core.relationships.CartographyRelSchema"><em>CartographyRelSchema</em></a>) – The relationship schema object defining
the structure of relationships to clean up. Must have source_node_matcher
and target_node_matcher defined.</p></li>
<li><p><strong>sub_resource_label</strong> (<em>str</em>) – The label of the sub-resource to scope cleanup to.</p></li>
<li><p><strong>sub_resource_id</strong> (<em>str</em>) – The ID of the sub-resource to scope cleanup to.</p></li>
<li><p><strong>update_tag</strong> (<em>int</em>) – The update tag to identify stale relationships.</p></li>
<li><p><strong>iterationsize</strong> (<em>int</em><em>, </em><em>optional</em>) – The number of items to process in each iteration.
Defaults to 100.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A new GraphJob instance configured for matchlink cleanup.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#cartography.graph.job.GraphJob" title="cartography.graph.job.GraphJob">GraphJob</a></p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>This method is specifically designed for matchlink cleanup operations.</p></li>
<li><p>Required relationship properties <code class="docutils literal notranslate"><span class="pre">_sub_resource_label</span></code> and <code class="docutils literal notranslate"><span class="pre">_sub_resource_id</span></code>
must be defined in the rel_schema.</p></li>
<li><p>For a given rel_schema, the fields used in the rel_schema.properties._sub_resource_label.name and</p></li>
</ul>
<p>rel_schema.properties._sub_resource_id.name must be provided as keys and values in the params dict.
- The rel_schema must have a source_node_matcher and target_node_matcher.
- The number of items to process in each iteration. Defaults to 100.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="cartography.graph.job.GraphJob.from_node_schema">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_node_schema</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node_schema</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="model.html#cartography.models.core.nodes.CartographyNodeSchema" title="cartography.models.core.nodes.CartographyNodeSchema"><span class="pre">CartographyNodeSchema</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">parameters</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iterationsize</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cascade_delete</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#cartography.graph.job.GraphJob" title="cartography.graph.job.GraphJob"><span class="pre">GraphJob</span></a></span></span><a class="headerlink" href="#cartography.graph.job.GraphJob.from_node_schema" title="Link to this definition">¶</a></dt>
<dd><p>Create a cleanup job from a CartographyNodeSchema.</p>
<p>This class method generates a cleanup job that removes stale nodes and
relationships based on the provided node schema configuration. It automatically
creates the necessary cleanup queries and validates that all required
parameters are provided.</p>
<p>For a given node, the fields used in the
node_schema.sub_resource_relationship.target_node_matcher.keys()
must be provided as keys and values in the parameters dict.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>node_schema</strong> (<a class="reference internal" href="model.html#cartography.models.core.nodes.CartographyNodeSchema" title="cartography.models.core.nodes.CartographyNodeSchema"><em>CartographyNodeSchema</em></a>) – The node schema object defining
the structure and relationships of nodes to clean up.</p></li>
<li><p><strong>parameters</strong> (<em>Dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em>) – Parameters for the cleanup queries.
Must include all parameters required by the generated queries.
Common parameters include UPDATE_TAG and sub-resource identifiers.</p></li>
<li><p><strong>iterationsize</strong> (<em>int</em><em>, </em><em>optional</em>) – The number of items to process in each iteration.
Defaults to 100.</p></li>
<li><p><strong>cascade_delete</strong> (<em>bool</em>) – If True, also delete all child nodes that have a
relationship to stale nodes matching node_schema.sub_resource_relationship.rel_label.
Defaults to False to preserve existing behavior.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A new GraphJob instance configured for cleanup operations.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#cartography.graph.job.GraphJob" title="cartography.graph.job.GraphJob">GraphJob</a></p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If the provided parameters don’t match the expected
    parameters for the cleanup queries.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="cartography.graph.job.GraphJob.merge_parameters">
<span class="sig-name descname"><span class="pre">merge_parameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parameters</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#cartography.graph.job.GraphJob.merge_parameters" title="Link to this definition">¶</a></dt>
<dd><p>Merge parameters into all job statements.</p>
<p>This method distributes the provided parameters to all statements in the job,
allowing for centralized parameter management at the job level.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>parameters</strong> (<em>Dict</em>) – Dictionary of parameters to merge into all statements.
Keys should match the parameter names used in the Neo4j queries.</p>
</dd>
</dl>
<div class="admonition-examples admonition">
<p class="admonition-title">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="n">job</span> <span class="o">=</span> <span class="n">GraphJob</span><span class="p">(</span><span class="s2">&quot;Test job&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">statement1</span><span class="p">,</span> <span class="n">statement2</span><span class="p">])</span>
</span><span data-line="2"><span class="gp">&gt;&gt;&gt; </span><span class="n">job</span><span class="o">.</span><span class="n">merge_parameters</span><span class="p">({</span><span class="s2">&quot;UPDATE_TAG&quot;</span><span class="p">:</span> <span class="mi">1642784400</span><span class="p">,</span> <span class="s2">&quot;account_id&quot;</span><span class="p">:</span> <span class="s2">&quot;123456789012&quot;</span><span class="p">})</span>
</span><span data-line="3"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># All statements in the job now have access to these parameters</span>
</span></pre></div>
</div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="cartography.graph.job.GraphJob.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">neo4j_session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Session</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#cartography.graph.job.GraphJob.run" title="Link to this definition">¶</a></dt>
<dd><p>Execute the job by running all statements sequentially.</p>
<p>This method executes each statement in the job in order. If any statement
fails, the entire job fails and subsequent statements are not executed.
Progress is logged at debug and info levels.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>neo4j_session</strong> (<em>neo4j.Session</em>) – The Neo4j session to use for execution.</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>Exception</strong> – Any exception raised by a statement execution is re-raised
    after logging the error.</p>
</dd>
</dl>
<div class="admonition-examples admonition">
<p class="admonition-title">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="n">job</span> <span class="o">=</span> <span class="n">GraphJob</span><span class="p">(</span><span class="s2">&quot;Cleanup job&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">cleanup_statement</span><span class="p">])</span>
</span><span data-line="2"><span class="gp">&gt;&gt;&gt; </span><span class="n">job</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">neo4j_session</span><span class="p">)</span>
</span><span data-line="3"><span class="go"># Logs: &quot;Starting job &#39;Cleanup job&#39;.&quot;</span>
</span><span data-line="4"><span class="go"># Logs: &quot;Finished job cleanup_job&quot; (if short_name is set)</span>
</span></pre></div>
</div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="cartography.graph.job.GraphJob.run_from_json">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">run_from_json</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">neo4j_session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Session</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">blob</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parameters</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">short_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#cartography.graph.job.GraphJob.run_from_json" title="Link to this definition">¶</a></dt>
<dd><p>Create and execute a job from a JSON string.</p>
<p>This convenience method combines job creation and execution in a single call.
It deserializes the JSON, merges parameters, and executes all statements.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>neo4j_session</strong> (<em>neo4j.Session</em>) – The Neo4j session to use for execution.</p></li>
<li><p><strong>blob</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>dict</em><em>]</em>) – The JSON string or dictionary containing the job definition.
If a string is provided, it will be parsed as JSON. If a dictionary is provided,
it will be used directly.</p></li>
<li><p><strong>parameters</strong> (<em>Dict</em>) – Parameters to merge into all job statements.</p></li>
<li><p><strong>short_name</strong> (<em>Optional</em><em>[</em><em>str</em><em>]</em>) – Override the short name for the job.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="cartography.graph.job.GraphJob.run_from_json_file">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">run_from_json_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">neo4j_session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Session</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parameters</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#cartography.graph.job.GraphJob.run_from_json_file" title="Link to this definition">¶</a></dt>
<dd><p>Create and execute a job from a JSON file.</p>
<p>This convenience method combines job creation from file and execution in a single call.
It reads the JSON file, merges parameters, and executes all statements.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file_path</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>Path</em><em>]</em>) – The path to the JSON file containing the job definition.</p></li>
<li><p><strong>neo4j_session</strong> (<em>neo4j.Session</em>) – The Neo4j session to use for execution.</p></li>
<li><p><strong>parameters</strong> (<em>Dict</em>) – Parameters to merge into all job statements.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>FileNotFoundError</strong> – If the specified file does not exist.</p></li>
<li><p><strong>json.JSONDecodeError</strong> – If the file contains invalid JSON.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="cartography.graph.job.GraphJobJSONEncoder">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">cartography.graph.job.</span></span><span class="sig-name descname"><span class="pre">GraphJobJSONEncoder</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skipkeys</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ensure_ascii</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">check_circular</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allow_nan</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sort_keys</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indent</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">separators</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cartography.graph.job.GraphJobJSONEncoder" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">JSONEncoder</span></code></p>
<p>JSON encoder with support for GraphJob instances.</p>
<p>This custom JSON encoder extends the default JSONEncoder to handle serialization
of GraphJob objects. It automatically converts GraphJob instances to their
dictionary representation using the <code class="docutils literal notranslate"><span class="pre">as_dict()</span></code> method.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This encoder only handles GraphJob instances. For other custom objects,
it falls back to the default JSONEncoder behavior, which may raise
a TypeError for non-serializable objects.</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="cartography.graph.job.GraphJobJSONEncoder.default">
<span class="sig-name descname"><span class="pre">default</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obj</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Any</span></span></span><a class="headerlink" href="#cartography.graph.job.GraphJobJSONEncoder.default" title="Link to this definition">¶</a></dt>
<dd><p>Handle serialization of custom objects.</p>
<p>This method is called by the JSON encoder for objects that are not
natively serializable. It converts GraphJob instances to dictionaries
and delegates other objects to the default encoder.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>obj</strong> (<em>Any</em>) – The object to be serialized.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The serializable representation of the object.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Any</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>TypeError</strong> – If the object is not a GraphJob and cannot be serialized
    by the default encoder.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cartography.graph.job.get_parameters">
<span class="sig-prename descclassname"><span class="pre">cartography.graph.job.</span></span><span class="sig-name descname"><span class="pre">get_parameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">queries</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Set</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#cartography.graph.job.get_parameters" title="Link to this definition">¶</a></dt>
<dd><p>Extract all parameters from a list of Neo4j queries.</p>
<p>This function analyzes all given Neo4j queries and extracts all parameter identifiers
that start with ‘$’. It’s useful for validating that all required parameters are
provided before executing a job.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>queries</strong> (<em>List</em><em>[</em><em>str</em><em>]</em>) – A list of Neo4j queries with parameters indicated by
leading ‘$’ (e.g., <code class="docutils literal notranslate"><span class="pre">$node_id</span></code>, <code class="docutils literal notranslate"><span class="pre">$update_tag</span></code>).</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The set of all unique parameters across all given Neo4j queries.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Set[str]</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This function is commonly used in <code class="docutils literal notranslate"><span class="pre">GraphJob.from_node_schema()</span></code> to validate
that all required parameters are provided for cleanup queries.</p>
</div>
</dd></dl>

</section>
<section id="module-cartography.graph.statement">
<span id="graphstatement"></span><h2>GraphStatement<a class="headerlink" href="#module-cartography.graph.statement" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="cartography.graph.statement.GraphStatement">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">cartography.graph.statement.</span></span><span class="sig-name descname"><span class="pre">GraphStatement</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parameters</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iterative</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iterationsize</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parent_job_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parent_job_sequence_num</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cartography.graph.statement.GraphStatement" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A statement that will run against the cartography graph. Statements can query or update the graph.</p>
<p>This class encapsulates a Neo4j Cypher query along with its parameters and execution
configuration. It supports both regular and iterative execution modes, and provides
comprehensive logging and statistics tracking.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="cartography.graph.statement.GraphStatement.query">
<span class="sig-name descname"><span class="pre">query</span></span><a class="headerlink" href="#cartography.graph.statement.GraphStatement.query" title="Link to this definition">¶</a></dt>
<dd><p>The Cypher query to run.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="cartography.graph.statement.GraphStatement.parameters">
<span class="sig-name descname"><span class="pre">parameters</span></span><a class="headerlink" href="#cartography.graph.statement.GraphStatement.parameters" title="Link to this definition">¶</a></dt>
<dd><p>The parameters to use for the query.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Dict[Any, Any]</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="cartography.graph.statement.GraphStatement.iterative">
<span class="sig-name descname"><span class="pre">iterative</span></span><a class="headerlink" href="#cartography.graph.statement.GraphStatement.iterative" title="Link to this definition">¶</a></dt>
<dd><p>Whether the statement is iterative. If True, the statement will be run
in chunks of size <cite>iterationsize</cite> until no more records are returned.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="cartography.graph.statement.GraphStatement.iterationsize">
<span class="sig-name descname"><span class="pre">iterationsize</span></span><a class="headerlink" href="#cartography.graph.statement.GraphStatement.iterationsize" title="Link to this definition">¶</a></dt>
<dd><p>The size of each chunk for iterative statements.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="cartography.graph.statement.GraphStatement.parent_job_name">
<span class="sig-name descname"><span class="pre">parent_job_name</span></span><a class="headerlink" href="#cartography.graph.statement.GraphStatement.parent_job_name" title="Link to this definition">¶</a></dt>
<dd><p>The name of the parent job this statement belongs to.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Optional[str]</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="cartography.graph.statement.GraphStatement.parent_job_sequence_num">
<span class="sig-name descname"><span class="pre">parent_job_sequence_num</span></span><a class="headerlink" href="#cartography.graph.statement.GraphStatement.parent_job_sequence_num" title="Link to this definition">¶</a></dt>
<dd><p>The sequence number of this statement within the parent job.
This is used for logging and tracking purposes.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Optional[int]</p>
</dd>
</dl>
</dd></dl>

<div class="admonition-examples admonition">
<p class="admonition-title">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Simple query statement</span>
</span><span data-line="2"><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">GraphStatement</span><span class="p">(</span><span class="s2">&quot;MATCH (n:User) RETURN count(n)&quot;</span><span class="p">)</span>
</span><span data-line="3"><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
</span></pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Statement with parameters</span>
</span><span data-line="2"><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">GraphStatement</span><span class="p">(</span>
</span><span data-line="3"><span class="gp">... </span>    <span class="s2">&quot;MATCH (n:User) WHERE n.name = $name RETURN n&quot;</span><span class="p">,</span>
</span><span data-line="4"><span class="gp">... </span>    <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Alice&quot;</span><span class="p">}</span>
</span><span data-line="5"><span class="gp">... </span><span class="p">)</span>
</span></pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Iterative statement for large datasets</span>
</span><span data-line="2"><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">GraphStatement</span><span class="p">(</span>
</span><span data-line="3"><span class="gp">... </span>    <span class="s2">&quot;MATCH (n:User) SET n.processed = true LIMIT $LIMIT_SIZE&quot;</span><span class="p">,</span>
</span><span data-line="4"><span class="gp">... </span>    <span class="n">iterative</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="5"><span class="gp">... </span>    <span class="n">iterationsize</span><span class="o">=</span><span class="mi">1000</span>
</span><span data-line="6"><span class="gp">... </span><span class="p">)</span>
</span></pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For iterative statements, the query should include a LIMIT clause using the
$LIMIT_SIZE parameter, which is automatically set to the iterationsize value.</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="cartography.graph.statement.GraphStatement.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parameters</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iterative</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iterationsize</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parent_job_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parent_job_sequence_num</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cartography.graph.statement.GraphStatement.__init__" title="Link to this definition">¶</a></dt>
<dd><p>Initialize a GraphStatement instance.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>query</strong> (<em>str</em>) – The Cypher query to execute.</p></li>
<li><p><strong>parameters</strong> (<em>Optional</em><em>[</em><em>Dict</em><em>[</em><em>Any</em><em>, </em><em>Any</em><em>]</em><em>]</em><em>, </em><em>optional</em>) – Parameters to pass to the query.
Defaults to None (empty dict).</p></li>
<li><p><strong>iterative</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to run the statement iteratively in chunks.
Defaults to False.</p></li>
<li><p><strong>iterationsize</strong> (<em>int</em><em>, </em><em>optional</em>) – Size of each chunk for iterative execution.
Defaults to 0. Must be &gt; 0 if iterative=True.</p></li>
<li><p><strong>parent_job_name</strong> (<em>Optional</em><em>[</em><em>str</em><em>]</em><em>, </em><em>optional</em>) – Name of the parent job for logging.
Defaults to None.</p></li>
<li><p><strong>parent_job_sequence_num</strong> (<em>Optional</em><em>[</em><em>int</em><em>]</em><em>, </em><em>optional</em>) – Sequence number within the parent job.
Defaults to None (will be set to 1).</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="cartography.graph.statement.GraphStatement.as_dict">
<span class="sig-name descname"><span class="pre">as_dict</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#cartography.graph.statement.GraphStatement.as_dict" title="Link to this definition">¶</a></dt>
<dd><p>Convert statement to a dictionary representation.</p>
<p>This method serializes the GraphStatement instance into a dictionary
containing all the essential information needed to recreate the statement.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>A dictionary representation of the statement containing:</dt><dd><ul class="simple">
<li><p>query: The Cypher query string</p></li>
<li><p>parameters: The query parameters</p></li>
<li><p>iterative: Boolean indicating if the statement is iterative</p></li>
<li><p>iterationsize: The chunk size for iterative execution</p></li>
</ul>
</dd>
</dl>
</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>Dict[str, Any]</p>
</dd>
</dl>
<div class="admonition-examples admonition">
<p class="admonition-title">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">GraphStatement</span><span class="p">(</span>
</span><span data-line="2"><span class="gp">... </span>    <span class="s2">&quot;MATCH (n) RETURN count(n)&quot;</span><span class="p">,</span>
</span><span data-line="3"><span class="gp">... </span>    <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
</span><span data-line="4"><span class="gp">... </span>    <span class="n">iterative</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="5"><span class="gp">... </span>    <span class="n">iterationsize</span><span class="o">=</span><span class="mi">1000</span>
</span><span data-line="6"><span class="gp">... </span><span class="p">)</span>
</span><span data-line="7"><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt_dict</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
</span><span data-line="8"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Returns:</span>
</span><span data-line="9"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># {</span>
</span><span data-line="10"><span class="gp">&gt;&gt;&gt; </span><span class="c1">#     &quot;query&quot;: &quot;MATCH (n) RETURN count(n)&quot;,</span>
</span><span data-line="11"><span class="gp">&gt;&gt;&gt; </span><span class="c1">#     &quot;parameters&quot;: {&quot;limit&quot;: 10, &quot;LIMIT_SIZE&quot;: 1000},</span>
</span><span data-line="12"><span class="gp">&gt;&gt;&gt; </span><span class="c1">#     &quot;iterative&quot;: True,</span>
</span><span data-line="13"><span class="gp">&gt;&gt;&gt; </span><span class="c1">#     &quot;iterationsize&quot;: 1000</span>
</span><span data-line="14"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># }</span>
</span></pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This method is used by GraphStatementJSONEncoder for JSON serialization.
Parent job information is not included in the dictionary representation.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="cartography.graph.statement.GraphStatement.create_from_json">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">create_from_json</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">json_obj</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">short_job_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">job_sequence_num</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cartography.graph.statement.GraphStatement.create_from_json" title="Link to this definition">¶</a></dt>
<dd><p>Create a GraphStatement instance from a JSON object.</p>
<p>This class method constructs a GraphStatement from a dictionary representation,
typically loaded from a JSON file. It provides a convenient way to deserialize
stored statement configurations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>json_obj</strong> (<em>Dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em>) – The JSON object containing statement configuration.
Expected keys: “query”, “parameters”, “iterative”, “iterationsize”.</p></li>
<li><p><strong>short_job_name</strong> (<em>Optional</em><em>[</em><em>str</em><em>]</em><em>, </em><em>optional</em>) – The short name of the job this statement
belongs to, used for logging and naming. Defaults to None.</p></li>
<li><p><strong>job_sequence_num</strong> (<em>Optional</em><em>[</em><em>int</em><em>]</em><em>, </em><em>optional</em>) – The sequence number of this statement
within the job, used for logging and tracking. Defaults to None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A new GraphStatement instance created from the JSON object.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#cartography.graph.statement.GraphStatement" title="cartography.graph.statement.GraphStatement">GraphStatement</a></p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Missing keys in the JSON object will use default values:
- query: “” (empty string)
- parameters: {} (empty dict)
- iterative: False
- iterationsize: 0</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="cartography.graph.statement.GraphStatement.create_from_json_file">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">create_from_json_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cartography.graph.statement.GraphStatement.create_from_json_file" title="Link to this definition">¶</a></dt>
<dd><p>Create a GraphStatement instance from a JSON file.</p>
<p>This class method reads a JSON file and creates a GraphStatement instance
from its contents. It’s a convenient way to load statement configurations
from external files.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>file_path</strong> (<em>Path</em>) – The path to the JSON file to read.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A new GraphStatement instance created from the JSON file.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#cartography.graph.statement.GraphStatement" title="cartography.graph.statement.GraphStatement">GraphStatement</a></p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>FileNotFoundError</strong> – If the specified file does not exist.</p></li>
<li><p><strong>json.JSONDecodeError</strong> – If the file contains invalid JSON.</p></li>
<li><p><strong>PermissionError</strong> – If the file cannot be read due to permissions.</p></li>
</ul>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The job short name is automatically extracted from the filename (without extension)
using the get_job_shortname() utility function. The sequence number defaults to None.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="cartography.graph.statement.GraphStatement.merge_parameters">
<span class="sig-name descname"><span class="pre">merge_parameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parameters</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#cartography.graph.statement.GraphStatement.merge_parameters" title="Link to this definition">¶</a></dt>
<dd><p>Merge given parameters with existing parameters.</p>
<p>This method updates the statement’s parameters by merging the provided
parameters with the existing ones. New parameters will override existing
ones with the same key.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>parameters</strong> (<em>Dict</em>) – The parameters to merge into the existing parameters.</p>
</dd>
</dl>
<div class="admonition-examples admonition">
<p class="admonition-title">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">GraphStatement</span><span class="p">(</span><span class="s2">&quot;MATCH (n) WHERE n.id = $id RETURN n&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
</span><span data-line="2"><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span><span class="o">.</span><span class="n">merge_parameters</span><span class="p">({</span><span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>
</span><span data-line="3"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># stmt.parameters is now {&quot;id&quot;: 2, &quot;limit&quot;: 10, &quot;LIMIT_SIZE&quot;: 0}</span>
</span></pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This method creates a copy of the existing parameters before merging
to avoid modifying the original dictionary reference.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="cartography.graph.statement.GraphStatement.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Session</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#cartography.graph.statement.GraphStatement.run" title="Link to this definition">¶</a></dt>
<dd><p>Run the statement. This will execute the query against the graph.</p>
<p>This method executes the Cypher query using either iterative or non-iterative
execution based on the statement configuration. It handles logging and
statistics collection automatically.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>session</strong> (<em>neo4j.Session</em>) – The Neo4j session to use for executing the query.</p>
</dd>
</dl>
<div class="admonition-examples admonition">
<p class="admonition-title">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">GraphStatement</span><span class="p">(</span><span class="s2">&quot;MATCH (n:User) RETURN count(n)&quot;</span><span class="p">)</span>
</span><span data-line="2"><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
</span><span data-line="3"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Query executed and results processed</span>
</span></pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Iterative execution</span>
</span><span data-line="2"><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">GraphStatement</span><span class="p">(</span>
</span><span data-line="3"><span class="gp">... </span>    <span class="s2">&quot;MATCH (n:User) SET n.processed = true LIMIT $LIMIT_SIZE&quot;</span><span class="p">,</span>
</span><span data-line="4"><span class="gp">... </span>    <span class="n">iterative</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="5"><span class="gp">... </span>    <span class="n">iterationsize</span><span class="o">=</span><span class="mi">1000</span>
</span><span data-line="6"><span class="gp">... </span><span class="p">)</span>
</span><span data-line="7"><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
</span><span data-line="8"><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Query executed in chunks of 1000 until no more updates</span>
</span></pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For iterative statements, the method will continue running until
the query returns no updates (summary.counters.contains_updates is False).
Completion is logged with the parent job name and sequence number.</p>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="cartography.graph.statement.GraphStatementJSONEncoder">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">cartography.graph.statement.</span></span><span class="sig-name descname"><span class="pre">GraphStatementJSONEncoder</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skipkeys</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ensure_ascii</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">check_circular</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allow_nan</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sort_keys</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indent</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">separators</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cartography.graph.statement.GraphStatementJSONEncoder" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">JSONEncoder</span></code></p>
<p>Support JSON serialization for GraphStatement instances.</p>
<p>This custom JSON encoder extends the default JSONEncoder to handle
GraphStatement objects by converting them to dictionaries using their
as_dict() method.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This encoder only handles GraphStatement objects. All other objects
are passed to the default JSONEncoder, which may raise TypeError
for non-serializable objects.</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="cartography.graph.statement.GraphStatementJSONEncoder.default">
<span class="sig-name descname"><span class="pre">default</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obj</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cartography.graph.statement.GraphStatementJSONEncoder.default" title="Link to this definition">¶</a></dt>
<dd><p>Implement this method in a subclass such that it returns
a serializable object for <code class="docutils literal notranslate"><span class="pre">o</span></code>, or calls the base implementation
(to raise a <code class="docutils literal notranslate"><span class="pre">TypeError</span></code>).</p>
<p>For example, to support arbitrary iterators, you could
implement default like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">def</span><span class="w"> </span><span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
</span><span data-line="2">    <span class="k">try</span><span class="p">:</span>
</span><span data-line="3">        <span class="n">iterable</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
</span><span data-line="4">    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span data-line="5">        <span class="k">pass</span>
</span><span data-line="6">    <span class="k">else</span><span class="p">:</span>
</span><span data-line="7">        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span>
</span><span data-line="8">    <span class="c1"># Let the base class default method raise the TypeError</span>
</span><span data-line="9">    <span class="k">return</span> <span class="n">JSONEncoder</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span>
</span></pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="cartography.graph.statement.get_job_shortname">
<span class="sig-prename descclassname"><span class="pre">cartography.graph.statement.</span></span><span class="sig-name descname"><span class="pre">get_job_shortname</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="headerlink" href="#cartography.graph.statement.get_job_shortname" title="Link to this definition">¶</a></dt>
<dd><p>Extract the short name from a file path by removing the extension.</p>
<p>This utility function takes a file path and returns the path without the
file extension. Note that the directory path is preserved.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>file_path</strong> (<em>Union</em><em>[</em><em>Path</em><em>, </em><em>str</em><em>]</em>) – The file path to process, can be a Path object or string.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The file path without extension.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
<div class="admonition-examples admonition">
<p class="admonition-title">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="n">get_job_shortname</span><span class="p">(</span><span class="s2">&quot;/path/to/my_job.json&quot;</span><span class="p">)</span>
</span><span data-line="2"><span class="go">&#39;/path/to/my_job&#39;</span>
</span><span data-line="3"><span class="gp">&gt;&gt;&gt; </span><span class="n">get_job_shortname</span><span class="p">(</span><span class="s2">&quot;config.yaml&quot;</span><span class="p">)</span>
</span><span data-line="4"><span class="go">&#39;config&#39;</span>
</span><span data-line="5"><span class="gp">&gt;&gt;&gt; </span><span class="n">get_job_shortname</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/jobs/data_sync.py&quot;</span><span class="p">))</span>
</span><span data-line="6"><span class="go">&#39;/jobs/data_sync&#39;</span>
</span></pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This function is planned to be moved to cartography.util after refactoring
of the run_*_job functions to cartography.graph.job.</p>
</div>
</dd></dl>

</section>
<section id="module-cartography.graph.context">
<span id="context"></span><h2>Context<a class="headerlink" href="#module-cartography.graph.context" title="Link to this heading">¶</a></h2>
<p>Context management for synchronization jobs.</p>
<p>This module provides context objects with well-documented fields that can be passed
between different parts of the sync job and used to get parameters for job queries.
The context system allows for clean parameter passing and enables module-specific
context extensions through subclassing.</p>
<p>The general workflow is:
1. Create a base Context with common parameters (like update_tag)
2. Pass it to sync modules that need access to these parameters
3. Optionally extend it with module-specific context using subclassing</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The context pattern promotes clean separation of concerns by allowing each
module to access only the parameters it needs while maintaining a consistent
interface for parameter passing throughout the sync pipeline.</p>
</div>
<dl class="py class">
<dt class="sig sig-object py" id="cartography.graph.context.Context">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">cartography.graph.context.</span></span><span class="sig-name descname"><span class="pre">Context</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">update_tag</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cartography.graph.context.Context" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Base context class for synchronization job parameters.</p>
<p>This class provides a standardized way to pass parameters between different
parts of the sync job. It can be subclassed to create module-specific contexts
that extend the base functionality with additional fields.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="cartography.graph.context.Context.update_tag">
<span class="sig-name descname"><span class="pre">update_tag</span></span><a class="headerlink" href="#cartography.graph.context.Context.update_tag" title="Link to this definition">¶</a></dt>
<dd><p>A timestamp or identifier used to track when data was last updated.
This is typically used in Neo4j queries to identify and clean up stale data.</p>
</dd></dl>

<div class="admonition-examples admonition">
<p class="admonition-title">Examples</p>
<p>Basic usage:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="n">ctx</span> <span class="o">=</span> <span class="n">Context</span><span class="p">(</span><span class="n">update_tag</span><span class="o">=</span><span class="mi">1642784400</span><span class="p">)</span>
</span><span data-line="2"><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">update_tag</span><span class="p">)</span>
</span><span data-line="3"><span class="go">1642784400</span>
</span></pre></div>
</div>
<p>Creating a module-specific context:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">DatabaseContext</span><span class="p">(</span><span class="n">Context</span><span class="p">):</span>
</span><span data-line="2"><span class="gp">... </span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update_tag</span><span class="p">,</span> <span class="n">db_host</span><span class="p">,</span> <span class="n">db_port</span><span class="p">):</span>
</span><span data-line="3"><span class="gp">... </span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">update_tag</span><span class="p">)</span>
</span><span data-line="4"><span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">db_host</span> <span class="o">=</span> <span class="n">db_host</span>
</span><span data-line="5"><span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">db_port</span> <span class="o">=</span> <span class="n">db_port</span>
</span><span data-line="6"><span class="gp">...</span>
</span><span data-line="7"><span class="gp">... </span>    <span class="nd">@classmethod</span>
</span><span data-line="8"><span class="gp">... </span>    <span class="k">def</span><span class="w"> </span><span class="nf">from_context</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">db_host</span><span class="p">,</span> <span class="n">db_port</span><span class="p">):</span>
</span><span data-line="9"><span class="gp">... </span>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">update_tag</span><span class="p">,</span> <span class="n">db_host</span><span class="p">,</span> <span class="n">db_port</span><span class="p">)</span>
</span></pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="n">base_ctx</span> <span class="o">=</span> <span class="n">Context</span><span class="p">(</span><span class="n">update_tag</span><span class="o">=</span><span class="mi">1642784400</span><span class="p">)</span>
</span><span data-line="2"><span class="gp">&gt;&gt;&gt; </span><span class="n">db_ctx</span> <span class="o">=</span> <span class="n">DatabaseContext</span><span class="o">.</span><span class="n">from_context</span><span class="p">(</span><span class="n">base_ctx</span><span class="p">,</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="mi">5432</span><span class="p">)</span>
</span><span data-line="3"><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">db_ctx</span><span class="o">.</span><span class="n">update_tag</span><span class="p">,</span> <span class="n">db_ctx</span><span class="o">.</span><span class="n">db_host</span><span class="p">,</span> <span class="n">db_ctx</span><span class="o">.</span><span class="n">db_port</span><span class="p">)</span>
</span><span data-line="4"><span class="go">1642784400 localhost 5432</span>
</span></pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Subclasses should implement a <code class="docutils literal notranslate"><span class="pre">from_context</span></code> class method to enable easy
conversion from a base context to the specialized context. This pattern
maintains consistency across different context types.</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="cartography.graph.context.Context.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">update_tag</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cartography.graph.context.Context.__init__" title="Link to this definition">¶</a></dt>
<dd><p>Initialize a new Context instance.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>update_tag</strong> – A timestamp or identifier used to track data freshness.
This is typically used in cleanup queries to identify stale data.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
</section>

        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"><div class="navigation-prev">
    <a href="model.html">
      <i class="i-lucide chevron-left"></i>
      <div class="page-info">
        <span>Previous</span><div class="title">Model</div></div>
    </a>
  </div><div class="navigation-next">
    <a href="sync.html">
      <div class="page-info">
        <span>Next</span>
        <div class="title">Sync</div>
      </div>
      <i class="i-lucide chevron-right"></i>
    </a>
  </div></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2021-2026, The Linux Foundation</p>
  
  <p>
    Made with
    
    <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials">
<a href="https://github.com/cartography-cncf/cartography" aria-label="GitHub">
  <iconify-icon icon="simple-icons:github"></iconify-icon>
</a>
<a href="https://communityinviter.com/apps/cloud-native/cncf" aria-label="Slack">
  <iconify-icon icon="simple-icons:slack"></iconify-icon>
</a></div>
    </div>
  </div>
</footer>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
      <script src="../_static/shibuya.js?v=cac61aee"></script></body>
</html>